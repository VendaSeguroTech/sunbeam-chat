{
  "name": "ia 1.0.6 ( beta ) 'original' copia",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "0fc3496c-5dfa-4772-8661-da71da6353c7",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -1264,
        896
      ],
      "id": "aab247d9-cd5b-4d19-89de-94c1857d8b1c",
      "name": "Webhook",
      "webhookId": "0fc3496c-5dfa-4772-8661-da71da6353c7"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        2192,
        320
      ],
      "id": "4a5512da-07b0-46f9-ba46-adf0bed002d0",
      "name": "Resposta"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Você é um revisor de histórico de conversa, especializado em identificar e corrigir tanto erros de linguagem quanto eventuais informações incorretas ou inconsistentes. Para cada par de mensagens:\n\nPreserve as tags ***Humano:*** e ***IA Resposta:***.\n\nVerifique gramática, pontuação e clareza.\n\nValide se o conteúdo apresenta algum dado incorreto, contraditório ou impreciso (seja do humano ou da IA).\n\nSe encontrar algo para corrigir (linguagem ou fato), produza apenas a versão corrigida, mantendo as tags.\n\nSe tudo estiver correto, retorne o par exatamente como recebeu.\n\nNão adicione comentários extras, explicações ou metadiscursos—saia estritamente no formato abaixo.\n\n{{ $json.content }}",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        3104,
        848
      ],
      "id": "cf41e4e2-875d-47ce-aa9f-5ddb78c37c66",
      "name": "AI Agent1",
      "disabled": true
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Webhook').item.json.body.message }}",
                    "rightValue": "/insert",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    },
                    "id": "604edc79-0a81-4eb5-bc12-fa40c49e4f91"
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        3200,
        592
      ],
      "id": "87a383d7-7f93-4dae-bc26-434008845dbb",
      "name": "Verificar a entrada do usuário"
    },
    {
      "parameters": {
        "operation": "update",
        "documentURL": "https://docs.google.com/document/d/1HOsBf9rdSzONzotc_aRVCsYPeK55pLANYaa_F68X1EI/edit?tab=t.0",
        "actionsUi": {
          "actionFields": [
            {
              "action": "insert",
              "text": "=  ***Humano:*** {{ $('Webhook').item.json.body.message }} ***IA Resposta:*** {{ $json.output }}  "
            }
          ]
        }
      },
      "type": "n8n-nodes-base.googleDocs",
      "typeVersion": 2,
      "position": [
        3408,
        592
      ],
      "id": "866df657-4516-4860-8503-f2fa865687e7",
      "name": "Atualizar documento com dados recebidos",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "4WNH8Rkm8qdPvZND",
          "name": "Google Docs account"
        }
      }
    },
    {
      "parameters": {
        "operation": "get",
        "documentURL": "https://docs.google.com/document/d/1HOsBf9rdSzONzotc_aRVCsYPeK55pLANYaa_F68X1EI/edit?tab=t.0"
      },
      "type": "n8n-nodes-base.googleDocs",
      "typeVersion": 2,
      "position": [
        2896,
        960
      ],
      "id": "76d3adb2-8816-4aab-bb52-b3d2afbe0962",
      "name": "Recuperar o documento",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "4WNH8Rkm8qdPvZND",
          "name": "Google Docs account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "operation": "update",
        "documentURL": "https://docs.google.com/document/d/1HOsBf9rdSzONzotc_aRVCsYPeK55pLANYaa_F68X1EI/edit?tab=t.0",
        "actionsUi": {
          "actionFields": [
            {
              "action": "replaceAll",
              "text": "={{ $('Recuperar o documento').item.json.content }}",
              "replaceText": "={{ $json.output }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.googleDocs",
      "typeVersion": 2,
      "position": [
        3520,
        928
      ],
      "id": "e4232e06-f18c-4044-9855-495ab1c8da67",
      "name": "Atualizar documento com informações Novas e revisadas",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "4WNH8Rkm8qdPvZND",
          "name": "Google Docs account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "content": "## Implementa novos conteudos no documento de aprendizagem",
        "height": 732,
        "width": 1068,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2704,
        400
      ],
      "typeVersion": 1,
      "id": "6610474a-bd3d-4ae6-b4f4-1b9230f65572",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "tableId": "n8n_chat_histories",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "session_id",
              "fieldValue": "={{ $('get sessionId && userId').item.json.body.sessionId }}"
            },
            {
              "fieldId": "user_id",
              "fieldValue": "={{ $('get sessionId && userId').item.json.userId }}"
            },
            {
              "fieldId": "message",
              "fieldValue": "={{ $json.output }}"
            },
            {
              "fieldId": "model",
              "fieldValue": "={{ $('Webhook').item.json.body.model }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        2880,
        736
      ],
      "id": "d2e28347-53b1-4662-aaa3-657c2cdf7e8f",
      "name": "Salva RP IA",
      "credentials": {
        "supabaseApi": {
          "id": "4PGtFDuqvBvB3tvc",
          "name": "supabase VPS"
        }
      }
    },
    {
      "parameters": {
        "tableId": "n8n_chat_histories",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "session_id",
              "fieldValue": "={{ $('get sessionId && userId').item.json.body.sessionId }}"
            },
            {
              "fieldId": "message",
              "fieldValue": "={{ $('Webhook').item.json.body.message }}"
            },
            {
              "fieldId": "user_id",
              "fieldValue": "={{ $('get sessionId && userId').item.json.userId }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        2880,
        576
      ],
      "id": "44dd56cc-e42d-4145-b7ef-c27e1a5b5c6a",
      "name": "Salva RP Human",
      "credentials": {
        "supabaseApi": {
          "id": "4PGtFDuqvBvB3tvc",
          "name": "supabase VPS"
        }
      }
    },
    {
      "parameters": {
        "content": "## supabase\n**salva as respostas no Banco de dados**",
        "height": 468,
        "width": 192,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2832,
        448
      ],
      "typeVersion": 1,
      "id": "bb2c615d-002f-49bd-80cf-26f66653a984",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "triggerOn": "specificFolder",
        "folderToWatch": {
          "__rl": true,
          "mode": "id",
          "value": "15WSAJ2bTLFcZLyViEnxmoMz1cZqMlM4X"
        },
        "event": "fileCreated",
        "options": {
          "fileType": "application/vnd.google-apps.video"
        }
      },
      "type": "n8n-nodes-base.googleDriveTrigger",
      "typeVersion": 1,
      "position": [
        2752,
        1296
      ],
      "id": "fef0e72e-8bc1-481c-84d2-5498d23b21b7",
      "name": "Files Created?1",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "lUbgshJTutnwWJS6",
          "name": "google drive tech"
        }
      }
    },
    {
      "parameters": {
        "url": "http://38.242.138.127:3118/transcrever",
        "options": {
          "timeout": 3600000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2928,
        1296
      ],
      "id": "922013cf-ff91-4d88-95bb-f4e527d4f11b",
      "name": "HTTP Request"
    },
    {
      "parameters": {
        "content": "**Alimenta a base de informações da IA com Videos d mentorias e outros criados no Drive",
        "height": 460,
        "width": 1252,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2704,
        1152
      ],
      "typeVersion": 1,
      "id": "13af0a43-0d00-4f9f-9196-b8dbf6c508f2",
      "name": "Sticky Note6"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "59f64116-f236-45fc-8334-19a0f5331945",
              "name": "sessionId",
              "value": "={{$json[\"body\"][\"sessionId\"]}}  ",
              "type": "string"
            },
            {
              "id": "01c983d8-efd5-4f4d-a447-78f26a0bdea8",
              "name": "userId",
              "value": "={{ $json.body.userId }}",
              "type": "string"
            },
            {
              "id": "dec266a3-da10-4c9d-9673-1f3fcb422476",
              "name": "output",
              "value": "={{ $json.body.message }}",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1040,
        896
      ],
      "id": "fe78b8d4-a536-4dd8-b129-75d7e71ce4d2",
      "name": "get sessionId && userId"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.status }}",
                    "rightValue": "success",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "6f2f2e89-8a16-42a7-bb81-fae8df145fcd"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "d2fd6892-af3f-4107-9de6-226d270bc2c5",
                    "leftValue": "={{ $json.status }}",
                    "rightValue": "failed",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        3072,
        1296
      ],
      "id": "764b275e-a100-46bc-9619-27c443c3edad",
      "name": "Switch"
    },
    {
      "parameters": {
        "sendTo": "andrezera.dev@gmail.com",
        "subject": "IA | transcribe fail",
        "message": "=<!DOCTYPE html>\n<html lang=\"pt-BR\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>Falha na Transcrição do Vídeo</title>\n</head>\n<body style=\"font-family: Arial, sans-serif; background: #f6f8fa; margin:0; padding:0;\">\n  <table align=\"center\" width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background: #f6f8fa;\">\n    <tr>\n      <td align=\"center\">\n        <table width=\"600\" cellpadding=\"24\" cellspacing=\"0\" style=\"background: #fff; margin-top: 30px; border-radius: 8px; box-shadow: 0 2px 12px #e6e6e6;\">\n          <tr>\n            <td align=\"center\">\n              <h2 style=\"color: #e74c3c; margin-bottom: 0;\">❌ Falha na transcrição do vídeo</h2>\n              <p style=\"font-size: 18px; color: #222; margin: 20px 0 10px;\">\n                Não foi possível transcrever o vídeo <strong>{{ARQUIVO}}</strong>.\n              </p>\n              <hr style=\"border:none; border-top:1px solid #eee; margin:20px 0;\">\n              <h4 style=\"color:#888;\">Motivo do erro:</h4>\n              <div style=\"background:#fff3f3; border-radius:4px; padding:16px; font-size:16px; color:#b71c1c; text-align:left;\">\n                {{DETALHES_ERRO}}\n              </div>\n              <p style=\"margin:24px 0 0 0; color: #555;\">\n                Por favor, verifique o vídeo ou tente novamente mais tarde.<br>\n                <small>Este é um aviso automático, por favor não responda este e-mail.</small>\n              </p>\n            </td>\n          </tr>\n        </table>\n        <p style=\"color:#bbb; font-size:12px; margin:24px 0 0 0;\">&copy; 2024 Sua Empresa - Transcrições Automáticas</p>\n      </td>\n    </tr>\n  </table>\n</body>\n</html>\n",
        "options": {
          "ccList": "tech@vendaseguro.com.br"
        }
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        3232,
        1360
      ],
      "id": "b6c1cb1a-acde-4c86-b9d6-0529c9fa6ff9",
      "name": "fail",
      "webhookId": "0cf502b9-8008-41e1-b721-89938ead7cbe",
      "credentials": {
        "gmailOAuth2": {
          "id": "sLRgd0Bhy67uTFLD",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "andrezera.dev@gmail.com",
        "subject": "IA | transcribe ok",
        "message": "<!DOCTYPE html> <html lang=\"pt-BR\"> <head>   <meta charset=\"UTF-8\">   <title>Transcrição Realizada com Sucesso</title> </head> <body style=\"font-family: Arial, sans-serif; background: #f6f8fa; margin:0; padding:0;\">   <table align=\"center\" width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background: #f6f8fa;\">     <tr>       <td align=\"center\">         <table width=\"600\" cellpadding=\"24\" cellspacing=\"0\" style=\"background: #fff; margin-top: 30px; border-radius: 8px; box-shadow: 0 2px 12px #e6e6e6;\">           <tr>             <td align=\"center\">               <h2 style=\"color: #38b000; margin-bottom: 0;\">✅ Transcrição realizada com sucesso!</h2>               <p style=\"font-size: 18px; color: #222; margin: 20px 0 10px;\">                 O vídeo <strong>{{ARQUIVO}}</strong> foi transcrito com êxito.               </p>               <hr style=\"border:none; border-top:1px solid #eee; margin:20px 0;\">               <h4 style=\"color:#888;\">Resumo da transcrição:</h4>               <div style=\"background:#f9f9f9; border-radius:4px; padding:16px; font-size:16px; color:#333; text-align:left; max-height:200px; overflow:auto;\">                 {{TRECHO_TRANSCRICAO}}               </div>               <p style=\"margin:24px 0 0 0; color: #555;\">                 Você pode acessar o arquivo completo ou usar o conteúdo conforme desejar.<br>                 <small>Este é um aviso automático, por favor não responda este e-mail.</small>               </p>             </td>           </tr>         </table>         <p style=\"color:#bbb; font-size:12px; margin:24px 0 0 0;\">&copy; 2024 Sua Empresa - Transcrições Automáticas</p>       </td>     </tr>   </table> </body> </html>",
        "options": {
          "ccList": "tech@vendaseguro.com.br"
        }
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        3232,
        1216
      ],
      "id": "aa36af0c-cb10-4059-b184-e7bad9189f5f",
      "name": "ok",
      "webhookId": "c5c5d67d-9107-403e-b5d9-a93f23bcd5da",
      "credentials": {
        "gmailOAuth2": {
          "id": "sLRgd0Bhy67uTFLD",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "resource": "file",
        "operation": "download",
        "path": "/root/bots/I.A/getTxt/transcription.txt",
        "options": {}
      },
      "type": "n8n-nodes-base.ssh",
      "typeVersion": 1,
      "position": [
        3392,
        1216
      ],
      "id": "a97e1880-5bb5-49e4-8659-0a314c8f4fa7",
      "name": "Download a file",
      "credentials": {
        "sshPassword": {
          "id": "eV1eDeR2og6BS6QP",
          "name": "SSH Password account"
        }
      }
    },
    {
      "parameters": {
        "folderId": "1wIivw82cPY0QokO0V_sdcTyQKoEUeksW",
        "title": "transcription"
      },
      "type": "n8n-nodes-base.googleDocs",
      "typeVersion": 2,
      "position": [
        3696,
        1216
      ],
      "id": "025e4ad3-90c9-4755-93f0-61b13cd8d046",
      "name": "Create a document",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "4WNH8Rkm8qdPvZND",
          "name": "Google Docs account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentURL": "={{ $json.id }}",
        "actionsUi": {
          "actionFields": [
            {
              "action": "insert",
              "text": "={{ $('Extract from File1').item.json.data }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.googleDocs",
      "typeVersion": 2,
      "position": [
        3712,
        1424
      ],
      "id": "3453d2d9-3ac6-4625-8ebc-4fc124685b24",
      "name": "Update a document",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "4WNH8Rkm8qdPvZND",
          "name": "Google Docs account"
        }
      }
    },
    {
      "parameters": {
        "operation": "text",
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        3536,
        1216
      ],
      "id": "f624db44-b12a-443a-9d3c-7c4b068a574d",
      "name": "Extract from File1"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.body.type }}",
                    "rightValue": "application/pdf",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "24b7bd60-756a-4c1d-abd1-e469f388cda5"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "26a148b1-9eea-4fbb-8fca-45114efbfd62",
                    "leftValue": "={{ $json.body.type }}",
                    "rightValue": "text",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -864,
        896
      ],
      "id": "dba9c85d-368e-4a2e-be4c-365c3dd07e39",
      "name": "type arquivo"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        3120,
        992
      ],
      "id": "144b0e78-8ab1-4579-b4bf-3155fc7e21e3",
      "name": "Google Gemini Chat Model1",
      "credentials": {
        "googlePalmApi": {
          "id": "3JiV6rPIxvxjMpnY",
          "name": "Google Gemini(PaLM) Api account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('get sessionId && userId').item.json.userId + '_' + $('get sessionId && userId').item.json.sessionId }}\n",
        "contextWindowLength": 10
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        4400,
        80
      ],
      "id": "320d5c80-60d7-4094-8010-7cf73bbd7266",
      "name": "Postgres Chat Memory1",
      "credentials": {
        "postgres": {
          "id": "EIS6qkRU8u6rsEzu",
          "name": "Postgres account / Supabase / Postgres"
        }
      }
    },
    {
      "parameters": {
        "content": "## recebe a pergunta",
        "height": 336,
        "width": 242
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1344,
        784
      ],
      "typeVersion": 1,
      "id": "1454e657-4d89-4bd6-8261-82f584d894a0",
      "name": "Sticky Note7"
    },
    {
      "parameters": {
        "content": "## Triggers",
        "height": 928,
        "width": 1312,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -2256,
        -1728
      ],
      "typeVersion": 1,
      "id": "61f94360-e8a4-46ae-8694-b8f5be76a7a3",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "content": "## atualiza o conteudo do arquivo adiiocando titulo e separando para melhorar a recuperação",
        "height": 1744,
        "width": 832,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -368,
        -1536
      ],
      "typeVersion": 1,
      "id": "fb6e8ebf-819f-4397-9e4c-9374c368fa9a",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "options": {
          "batchSize": 128,
          "stripNewLines": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        1776,
        -1264
      ],
      "id": "1ecbba4f-9e1c-4326-a2b0-34155e213006",
      "name": "Embeddings OpenAI1",
      "credentials": {
        "openAiApi": {
          "id": "6XodQNiVwLbmQE7G",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "chunkSize": 1200,
        "options": {
          "splitCode": "markdown"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter",
      "typeVersion": 1,
      "position": [
        1936,
        -1264
      ],
      "id": "eb5003b9-5d83-4557-ae95-b226628a9601",
      "name": "Recursive Character Text Splitter"
    },
    {
      "parameters": {
        "jsonMode": "expressionData",
        "jsonData": "={{ $json.data }}",
        "options": {
          "metadata": {
            "metadataValues": [
              {
                "name": "file_id",
                "value": "={{ $('set file_id').item.json.file_id }}"
              }
            ]
          }
        }
      },
      "id": "f70b8a6d-b37d-4165-ae89-64c4681d1ea7",
      "name": "Default Data Loader",
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "position": [
        2032,
        -1344
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "operation": "delete",
        "tableId": "documents",
        "filterType": "string",
        "filterString": "=metadata->>file_id=like.*{{ $json.file_id }}*"
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1040,
        -1392
      ],
      "id": "914a1b05-1263-4577-a7f5-77b1923147b1",
      "name": "Delete a row",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "maxTries": 2,
      "waitBetweenTries": 3000,
      "credentials": {
        "supabaseApi": {
          "id": "4PGtFDuqvBvB3tvc",
          "name": "supabase VPS"
        }
      }
    },
    {
      "parameters": {
        "mode": "insert",
        "tableName": {
          "__rl": true,
          "value": "documents",
          "mode": "list",
          "cachedResultName": "documents"
        },
        "embeddingBatchSize": 300,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        1776,
        -1456
      ],
      "id": "1ee3e787-4896-495c-83c3-c5eb6407f742",
      "name": "Supabase Vector Store",
      "credentials": {
        "supabaseApi": {
          "id": "4PGtFDuqvBvB3tvc",
          "name": "supabase VPS"
        }
      }
    },
    {
      "parameters": {
        "operation": "text",
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        1568,
        -1392
      ],
      "id": "e94fb97f-4f91-4a7e-8cfa-95c282f529ab",
      "name": "Extract from File"
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "={{ $('set file_id').item.json.file_id }}",
          "mode": "id"
        },
        "options": {
          "googleFileConversion": {
            "conversion": {
              "docsToFormat": "text/plain"
            }
          }
        }
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        1408,
        -1392
      ],
      "id": "0001e5f7-500f-4380-85b7-b5032123fdda",
      "name": "Download file",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "lUbgshJTutnwWJS6",
          "name": "google drive tech"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "924b0573-9a2a-4b7c-ad88-b2f71fbfb4c0",
              "name": "file_id",
              "value": "={{ $('Get a document').item.json.documentId }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        848,
        -1392
      ],
      "id": "272fd7de-7458-4d24-8a51-0a2dd99d2bc6",
      "name": "set file_id"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f25c3af0-bc83-4a73-b675-7c6168b7beea",
              "name": "file_id",
              "value": "={{ $json.id }}",
              "type": "string"
            },
            {
              "id": "387c5636-d3f4-4126-bf0d-665f9fb14e7e",
              "name": "name_arq",
              "value": "={{ $json.name }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -176,
        -1408
      ],
      "id": "b43e0157-e0a2-467f-8870-9771e5545ce9",
      "name": "set id"
    },
    {
      "parameters": {
        "operation": "get",
        "documentURL": "={{ $json.file_id }}"
      },
      "type": "n8n-nodes-base.googleDocs",
      "typeVersion": 2,
      "position": [
        0,
        -1408
      ],
      "id": "4af31b68-f796-4efd-b443-4e0ba7b447bb",
      "name": "Get a document",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "4WNH8Rkm8qdPvZND",
          "name": "Google Docs account"
        }
      }
    },
    {
      "parameters": {
        "content": "## Carrega os dados no nosso banco vetorial",
        "height": 1744,
        "width": 1168,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        528,
        -1536
      ],
      "typeVersion": 1,
      "id": "66303bdd-8c34-4dae-9fa7-12cc62ec28be",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "operation": "update",
        "documentURL": "={{ $('set id').item.json.file_id }}",
        "actionsUi": {
          "actionFields": [
            {
              "action": "replaceAll",
              "text": "={{ $('Get a document').item.json.content }}",
              "replaceText": "={{ $json.output }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.googleDocs",
      "typeVersion": 2,
      "position": [
        688,
        -1392
      ],
      "id": "af80e1df-cd87-4995-a6ab-8ed9b6124cd7",
      "name": "Update a document1",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "4WNH8Rkm8qdPvZND",
          "name": "Google Docs account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "8c1249ba-2270-49da-867b-6986173ac1e5",
                    "leftValue": "={{ $json.output }}",
                    "rightValue": "Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos?",
                    "operator": {
                      "type": "string",
                      "operation": "notContains"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.output }}",
                    "rightValue": "=Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos?",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    },
                    "id": "28368e6f-2c26-4be0-ae11-8150b413a47c"
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        1120,
        1008
      ],
      "id": "076d43ef-a722-4d5b-b56f-48a006bfba57",
      "name": "fallback"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "f497a2d6-61c0-4ba7-8f95-e5078a974f76",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        2576,
        -272
      ],
      "id": "5c1bfbba-102d-4956-ab34-f530aea55314",
      "name": "avaliação resposta:",
      "webhookId": "f497a2d6-61c0-4ba7-8f95-e5078a974f76"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "4985382e-55d4-4297-b4eb-b96f458670f8",
              "name": "message",
              "value": "={{ $json.body.message }}",
              "type": "string"
            },
            {
              "id": "f0f31815-57cb-4170-8752-3f869bc5eba5",
              "name": "rating",
              "value": "={{ $json.body.rating }}",
              "type": "string"
            },
            {
              "id": "31711fba-e498-4a63-869d-dda506e18cf8",
              "name": "session_id",
              "value": "={{ $json.body.sessionId }}",
              "type": "string"
            },
            {
              "id": "de23cb54-e411-4eee-9165-5795241662f5",
              "name": "user_id",
              "value": "={{ $json.body.userId }}",
              "type": "string"
            },
            {
              "id": "c0cf98cc-f2b5-46c5-ab14-cd53cfe0f76f",
              "name": "timestamp",
              "value": "={{ $json.body.timestamp }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2656,
        0
      ],
      "id": "89fd1422-2759-47ef-bd9b-7e68717d9d68",
      "name": "set fields"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.rating }}",
                    "rightValue": "=positive",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "c98e76d9-9c31-4e1e-812a-affab9a6c391"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "184c758c-a3e9-49a7-9b01-3084500a25d0",
                    "leftValue": "={{ $json.rating }}",
                    "rightValue": "negative",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        3168,
        112
      ],
      "id": "fe3492e6-2b06-435a-bbb4-a7b9b50477da",
      "name": "rating type"
    },
    {
      "parameters": {
        "operation": "update",
        "documentURL": "1d2j3It468zla0dL6L90eDO-SztkZeHmlgtGGpHn2qI8",
        "actionsUi": {
          "actionFields": [
            {
              "action": "insert",
              "text": "=________________________________________________________________\n\n*Pergunta feita pelo user* :{{ $('avaliação resposta:').item.json.body.question }}\n\n*RESPOSTA AVALIADA* : {{ $('avaliação resposta:').item.json.body.answer }}\n________________________________________________________________\n"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.googleDocs",
      "typeVersion": 2,
      "position": [
        3408,
        0
      ],
      "id": "516777eb-7cb2-4e2c-9ca5-ff551fee7e57",
      "name": "Gravar avaliação positiva",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "4WNH8Rkm8qdPvZND",
          "name": "Google Docs account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentURL": "1zMvs_gT33ad82xvyw184T1GcwiwKUFm_ktEgDbMoYjA",
        "actionsUi": {
          "actionFields": [
            {
              "action": "insert",
              "text": "=________________________________________________________________\n\n*Pergunta feita pelo user* :{{ $('avaliação resposta:').item.json.body.question }}\n\n*RESPOSTA AVALIADA* : {{ $('avaliação resposta:').item.json.body.answer }}\n________________________________________________________________\n"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.googleDocs",
      "typeVersion": 2,
      "position": [
        3408,
        208
      ],
      "id": "bff515a8-87eb-4e62-b05d-3bb9650f2397",
      "name": "Gravar avaliação negativa",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "4WNH8Rkm8qdPvZND",
          "name": "Google Docs account"
        }
      }
    },
    {
      "parameters": {
        "amount": 30
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        1248,
        -1392
      ],
      "id": "a116d1d2-fe2d-457a-8824-4b75fab06387",
      "name": "Wait",
      "webhookId": "8c3bdc1c-fb3e-4edf-b7a1-b8eb8e340e42"
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "triggerOn": "specificFolder",
        "folderToWatch": {
          "__rl": true,
          "value": "1toOONjip_Wg3VpO3ihm6kMjFGaNZ3XKt",
          "mode": "id"
        },
        "event": "fileUpdated",
        "options": {}
      },
      "type": "n8n-nodes-base.googleDriveTrigger",
      "typeVersion": 1,
      "position": [
        -1296,
        -1424
      ],
      "id": "3096a45f-abd1-4ddb-87bc-35f3feb87734",
      "name": "advogados e escr - update",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "lUbgshJTutnwWJS6",
          "name": "google drive tech"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Você é um agente especializado em reformular perguntas para otimizar a busca em sistemas RAG (Retrieval-Augmented Generation).  \nSua tarefa é:  \n- Receber a pergunta do usuário.  \n- Reformular em UMA única versão final, mais clara, objetiva e semanticamente otimizada para busca.  \n- Preservar todas as entidades (nomes, datas, locais, tecnologias, produtos).  \n- Usar sinônimos e simplificar a estrutura sem alterar o sentido.  \n- Retornar apenas a pergunta reformulada, sem explicações adicionais.  \n- Se a informação recebida for uma saudação ou coisa simples não precisa refatorar. \n\nretorne junto com a pergunta final algo como \"De acordo com os seus arquivos... \" assim icentivando ele a fazer a busca em sua base de dados RAG... \n\nA pergunta/informação é : \"{{ $json.output }}\"\n\nlembrando se for apenas uma saudação ou agradecimento, apenas repita de repasse a mesma informação que você recebeu acima... entre aspas\n\nnão mude muito a pergunta, refine levemente ela mantendo erros se encontrar e etc não adicione palavras que possam mudar o entendimento da pergunta... Apenas ajuste a semântica da pergunta ou conteudo recebido... ",
        "options": {
          "returnIntermediateSteps": true
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        3872,
        32
      ],
      "id": "4c84be85-6d11-4ae5-9e5c-7fb961f1f3bd",
      "name": "AI Agent2",
      "disabled": true
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "8c1249ba-2270-49da-867b-6986173ac1e5",
                    "leftValue": "={{ $json.output }}",
                    "rightValue": "Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos?",
                    "operator": {
                      "type": "string",
                      "operation": "notContains"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.output }}",
                    "rightValue": "=Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos?",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    },
                    "id": "28368e6f-2c26-4be0-ae11-8150b413a47c"
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        176,
        1056
      ],
      "id": "42b76029-0da4-4e1d-bbf4-45615c0c4d08",
      "name": "fallback2"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Você é um agente que recebe uma pergunta do usuário.\nSua tarefa é refazer a mesma pergunta em 3 variações diferentes, mantendo o mesmo objetivo original.\nAs reformulações devem ser claras, naturais e semanticamente equivalentes, mas escritas de forma diferente.\n\na pergunta : {{ $('Webhook').item.json.body.message }}\n\nreformule ela e gere três variações.\n\nSaída esperada: \n\nPergunta 1: …\n\nPergunta 2: …\n\nPergunta 3: … \n\n'Não escreva junto nas 3 perguntas o \"de acord ocom seus arquivos\"'\n\nObservação muito importante, se a pergunta recebida não tiver haver com o nicho de seguros, precisa responder exatamente a frase a seguir : \n “Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos?”\ncaso ao contrário pode retornar as 3 perguntas sobre seguros aleatórias...\n\nmas nunca retorne \n\n\"Primeira reformulação da pergunta original, mantendo o mesmo objetivo.\n\n\"Segunda reformulação; pode mencionar 'seus arquivos' em apenas uma das variações.\"\n ou até mesmo : Reformulação 2 da pergunta original\n\njamais retorne isso, \nse for para retornar dessa forma, retorne \n\n“Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos?”\n\nVerifique se não ha alguma palavra inclompleta, como seg (seguros) abri(abrir)",
        "hasOutputParser": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        1456,
        1216
      ],
      "id": "0ac6f20b-ec93-4496-8b14-c4ccb2704fcb",
      "name": "AI Agent3",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"question1\": {\n      \"type\": \"string\",\n      \"description\": \"Primeira reformulação clara e natural da pergunta original, em português, mantendo o mesmo objetivo. Não incluir 'de acordo com seus arquivos'.\"\n    },\n    \"question2\": {\n      \"type\": \"string\",\n      \"description\": \"Segunda reformulação clara e natural da pergunta original, em português, mantendo o mesmo objetivo. Não incluir 'de acordo com seus arquivos'.\"\n    },\n    \"question3\": {\n      \"type\": \"string\",\n      \"description\": \"Terceira reformulação clara e natural da pergunta original, em português, mantendo o mesmo objetivo. Não incluir 'de acordo com seus arquivos'.\"\n    }\n  },\n  \"required\": [\"question1\", \"question2\", \"question3\"],\n  \"additionalProperties\": false\n}\n"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        1616,
        1392
      ],
      "id": "f47811ae-fe1f-4076-8b48-fcc5ecb6b481",
      "name": "Structured Output Parser"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json.output }}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        2016,
        1056
      ],
      "id": "3a8d3831-c6f6-4758-9d10-b682e23437c2",
      "name": "resposta fallback"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        3872,
        192
      ],
      "id": "435eda12-83f7-4556-ab7e-69ab962c8e02",
      "name": "OpenAI Chat Model1",
      "credentials": {
        "openAiApi": {
          "id": "6XodQNiVwLbmQE7G",
          "name": "OpenAi account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.output.properties.question1.description }}",
                    "rightValue": "=Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos?",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    },
                    "id": "28368e6f-2c26-4be0-ae11-8150b413a47c"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "8c1249ba-2270-49da-867b-6986173ac1e5",
                    "leftValue": "={{ $json.output.properties.question1.description }}",
                    "rightValue": "Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos?",
                    "operator": {
                      "type": "string",
                      "operation": "notContains"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        1760,
        1040
      ],
      "id": "7986f293-9425-45c0-b05c-d1d8cafda2f9",
      "name": "fallback3"
    },
    {
      "parameters": {
        "content": "## supabase\n",
        "height": 1732,
        "width": 544,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1792,
        -1536
      ],
      "typeVersion": 1,
      "id": "248e907a-1afa-4947-9a70-c37dd622fa87",
      "name": "Sticky Note13"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "independente do que você receber de input responda unicamente e exatamente: \n\n “Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos?”",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        1968,
        768
      ],
      "id": "387b81c0-9a27-47ca-bfed-d9741316a0a1",
      "name": "AI Agent4"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5-nano",
          "mode": "list",
          "cachedResultName": "gpt-5-nano"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        1984,
        928
      ],
      "id": "b4dd2caa-480a-4484-8c08-721b7f0176ba",
      "name": "OpenAI Chat Model2",
      "credentials": {
        "openAiApi": {
          "id": "6XodQNiVwLbmQE7G",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5",
          "mode": "list",
          "cachedResultName": "gpt-5"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        1456,
        1392
      ],
      "id": "7c6cbddc-e02d-425f-b37e-f0d523339010",
      "name": "OpenAI Chat Model3",
      "credentials": {
        "openAiApi": {
          "id": "6XodQNiVwLbmQE7G",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "triggerOn": "specificFolder",
        "folderToWatch": {
          "__rl": true,
          "value": "1toOONjip_Wg3VpO3ihm6kMjFGaNZ3XKt",
          "mode": "id"
        },
        "event": "fileCreated",
        "options": {}
      },
      "type": "n8n-nodes-base.googleDriveTrigger",
      "typeVersion": 1,
      "position": [
        -1472,
        -1424
      ],
      "id": "d14dc674-ccbe-4109-bd1d-94ae4de8e257",
      "name": "advogados e escr - create",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "lUbgshJTutnwWJS6",
          "name": "google drive tech"
        }
      }
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "triggerOn": "specificFolder",
        "folderToWatch": {
          "__rl": true,
          "value": "1JgsPA1y9R5MsefgSWBWaVNGIY36RuJpD",
          "mode": "id"
        },
        "event": "fileUpdated",
        "options": {}
      },
      "type": "n8n-nodes-base.googleDriveTrigger",
      "typeVersion": 1,
      "position": [
        -1296,
        -1600
      ],
      "id": "7b01987b-83ec-468f-872c-e28654d935d2",
      "name": "main | updated",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "lUbgshJTutnwWJS6",
          "name": "google drive tech"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "triggerOn": "specificFolder",
        "folderToWatch": {
          "__rl": true,
          "value": "1JgsPA1y9R5MsefgSWBWaVNGIY36RuJpD",
          "mode": "id"
        },
        "event": "fileCreated",
        "options": {}
      },
      "type": "n8n-nodes-base.googleDriveTrigger",
      "typeVersion": 1,
      "position": [
        -1472,
        -1600
      ],
      "id": "da88717f-d9ec-43c9-8b86-78aa017230e8",
      "name": "main | created",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "lUbgshJTutnwWJS6",
          "name": "google drive tech"
        }
      }
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "triggerOn": "specificFolder",
        "folderToWatch": {
          "__rl": true,
          "value": "1jF9GjVv0ZCK2Ukquyphpa4qLzV6DeDGm",
          "mode": "id"
        },
        "event": "fileCreated",
        "options": {}
      },
      "type": "n8n-nodes-base.googleDriveTrigger",
      "typeVersion": 1,
      "position": [
        -1472,
        -1232
      ],
      "id": "99d6a973-0add-4c13-955a-25b9a06c02e5",
      "name": "banco ex sinistro | created",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "lUbgshJTutnwWJS6",
          "name": "google drive tech"
        }
      }
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "triggerOn": "specificFolder",
        "folderToWatch": {
          "__rl": true,
          "value": "1jF9GjVv0ZCK2Ukquyphpa4qLzV6DeDGm",
          "mode": "id"
        },
        "event": "fileUpdated",
        "options": {}
      },
      "type": "n8n-nodes-base.googleDriveTrigger",
      "typeVersion": 1,
      "position": [
        -1296,
        -1232
      ],
      "id": "2f052553-6943-4ed8-a5ab-6c887707db74",
      "name": "banco ex sinistro | update",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "lUbgshJTutnwWJS6",
          "name": "google drive tech"
        }
      }
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "triggerOn": "specificFolder",
        "folderToWatch": {
          "__rl": true,
          "value": "1YviNWooRZ_uNVOeA15umu6LVT2KFhqJ8",
          "mode": "id"
        },
        "event": "fileCreated",
        "options": {}
      },
      "type": "n8n-nodes-base.googleDriveTrigger",
      "typeVersion": 1,
      "position": [
        -1472,
        -1072
      ],
      "id": "755975e7-b169-4ea5-9033-d40cbb91bc01",
      "name": "contator + escritório | create",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "lUbgshJTutnwWJS6",
          "name": "google drive tech"
        }
      }
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "triggerOn": "specificFolder",
        "folderToWatch": {
          "__rl": true,
          "value": "1YviNWooRZ_uNVOeA15umu6LVT2KFhqJ8",
          "mode": "id"
        },
        "event": "fileUpdated",
        "options": {}
      },
      "type": "n8n-nodes-base.googleDriveTrigger",
      "typeVersion": 1,
      "position": [
        -1312,
        -1072
      ],
      "id": "5855a6ea-b4ba-40b9-96c3-da8bbe2b0464",
      "name": "contator + escritório | update",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "lUbgshJTutnwWJS6",
          "name": "google drive tech"
        }
      }
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "triggerOn": "specificFolder",
        "folderToWatch": {
          "__rl": true,
          "value": "1ktf5i5M9BXUC7I2d8a1ZCdmnEAnMoBNU",
          "mode": "id"
        },
        "event": "fileCreated",
        "options": {}
      },
      "type": "n8n-nodes-base.googleDriveTrigger",
      "typeVersion": 1,
      "position": [
        -640,
        -192
      ],
      "id": "0953970a-f28e-4128-aec2-eda18ee337a8",
      "name": "D&O | creaded",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "lUbgshJTutnwWJS6",
          "name": "google drive tech"
        }
      }
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "triggerOn": "specificFolder",
        "folderToWatch": {
          "__rl": true,
          "value": "1ktf5i5M9BXUC7I2d8a1ZCdmnEAnMoBNU",
          "mode": "id"
        },
        "event": "fileUpdated",
        "options": {}
      },
      "type": "n8n-nodes-base.googleDriveTrigger",
      "typeVersion": 1,
      "position": [
        -640,
        0
      ],
      "id": "018f49e4-8568-411e-bc03-ec87b7ba0cdb",
      "name": "D&O | updated",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "lUbgshJTutnwWJS6",
          "name": "google drive tech"
        }
      }
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "triggerOn": "specificFolder",
        "folderToWatch": {
          "__rl": true,
          "value": "15qtr_tDujQcP3_yogGT6fS09ZCKiX6Z0",
          "mode": "id"
        },
        "event": "fileCreated",
        "options": {}
      },
      "type": "n8n-nodes-base.googleDriveTrigger",
      "typeVersion": 1,
      "position": [
        -1856,
        -1600
      ],
      "id": "16424ef9-8d1b-45ca-99a4-31168ae249ed",
      "name": "dentistas + clinicas | created",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "lUbgshJTutnwWJS6",
          "name": "google drive tech"
        }
      }
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "triggerOn": "specificFolder",
        "folderToWatch": {
          "__rl": true,
          "value": "15qtr_tDujQcP3_yogGT6fS09ZCKiX6Z0",
          "mode": "id"
        },
        "event": "fileUpdated",
        "options": {}
      },
      "type": "n8n-nodes-base.googleDriveTrigger",
      "typeVersion": 1,
      "position": [
        -1664,
        -1600
      ],
      "id": "d96004db-1f30-473c-8864-031227b6f8ac",
      "name": "dentistas + clinicas | updated",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "lUbgshJTutnwWJS6",
          "name": "google drive tech"
        }
      }
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "triggerOn": "specificFolder",
        "folderToWatch": {
          "__rl": true,
          "value": "1CBVY72qP4NRQ0Br2Iwpj5akf90nVt7va",
          "mode": "id"
        },
        "event": "fileCreated",
        "options": {}
      },
      "type": "n8n-nodes-base.googleDriveTrigger",
      "typeVersion": 1,
      "position": [
        -1856,
        -1232
      ],
      "id": "b8a0599e-9eeb-44c9-8094-de6de59e2a7f",
      "name": "engenheiros + emp engenharia | created",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "lUbgshJTutnwWJS6",
          "name": "google drive tech"
        }
      }
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "triggerOn": "specificFolder",
        "folderToWatch": {
          "__rl": true,
          "value": "1CBVY72qP4NRQ0Br2Iwpj5akf90nVt7va",
          "mode": "id"
        },
        "event": "fileUpdated",
        "options": {}
      },
      "type": "n8n-nodes-base.googleDriveTrigger",
      "typeVersion": 1,
      "position": [
        -1664,
        -1232
      ],
      "id": "de09e2bc-77b9-4cab-9963-6c1b16af5828",
      "name": "engenheiros + emp engenharia | updated",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "lUbgshJTutnwWJS6",
          "name": "google drive tech"
        }
      }
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "triggerOn": "specificFolder",
        "folderToWatch": {
          "__rl": true,
          "value": "1WihOeRLgQ7QLmphu2JLM2VdJ5ZHxiXFQ",
          "mode": "id"
        },
        "event": "fileCreated",
        "options": {}
      },
      "type": "n8n-nodes-base.googleDriveTrigger",
      "typeVersion": 1,
      "position": [
        -1856,
        -1072
      ],
      "id": "894361c0-d197-4ff3-b0ac-6d12813a36ce",
      "name": "masterclasses | created",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "lUbgshJTutnwWJS6",
          "name": "google drive tech"
        }
      }
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "triggerOn": "specificFolder",
        "folderToWatch": {
          "__rl": true,
          "value": "1WihOeRLgQ7QLmphu2JLM2VdJ5ZHxiXFQ",
          "mode": "id"
        },
        "event": "fileUpdated",
        "options": {}
      },
      "type": "n8n-nodes-base.googleDriveTrigger",
      "typeVersion": 1,
      "position": [
        -1664,
        -1072
      ],
      "id": "7e5e2cf6-98a6-4d54-ac12-2380a5ad97ba",
      "name": "masterclasses | updated",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "lUbgshJTutnwWJS6",
          "name": "google drive tech"
        }
      }
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "triggerOn": "specificFolder",
        "folderToWatch": {
          "__rl": true,
          "value": "1aum_hdAqkGCWmFIvd7PD8TssuzoDPkzS",
          "mode": "id"
        },
        "event": "fileCreated",
        "options": {}
      },
      "type": "n8n-nodes-base.googleDriveTrigger",
      "typeVersion": 1,
      "position": [
        -2048,
        -1072
      ],
      "id": "5597c7a6-d7c7-48a1-9775-c267fa9f2f48",
      "name": "médico + clinica med | created",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "lUbgshJTutnwWJS6",
          "name": "google drive tech"
        }
      }
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "triggerOn": "specificFolder",
        "folderToWatch": {
          "__rl": true,
          "value": "1aum_hdAqkGCWmFIvd7PD8TssuzoDPkzS",
          "mode": "id"
        },
        "event": "fileUpdated",
        "options": {}
      },
      "type": "n8n-nodes-base.googleDriveTrigger",
      "typeVersion": 1,
      "position": [
        -2048,
        -1232
      ],
      "id": "68c7b01d-c719-4bb9-9385-fcbd2fb5daa9",
      "name": "médico + clinica med | updated",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "lUbgshJTutnwWJS6",
          "name": "google drive tech"
        }
      }
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "triggerOn": "specificFolder",
        "folderToWatch": {
          "__rl": true,
          "value": "1Do4_CwhVbc4qwvZzK1fpV-BczLW4jyf1",
          "mode": "id"
        },
        "event": "fileCreated",
        "options": {}
      },
      "type": "n8n-nodes-base.googleDriveTrigger",
      "typeVersion": 1,
      "position": [
        -2032,
        -1600
      ],
      "id": "598db768-a2f3-4063-bc61-32693a623413",
      "name": "mentorias | created",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "lUbgshJTutnwWJS6",
          "name": "google drive tech"
        }
      }
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "triggerOn": "specificFolder",
        "folderToWatch": {
          "__rl": true,
          "value": "1Do4_CwhVbc4qwvZzK1fpV-BczLW4jyf1",
          "mode": "id"
        },
        "event": "fileUpdated",
        "options": {}
      },
      "type": "n8n-nodes-base.googleDriveTrigger",
      "typeVersion": 1,
      "position": [
        -2048,
        -1408
      ],
      "id": "c272f5a7-c1be-4801-957c-27b2dc6086e2",
      "name": "mentorias | updated",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "lUbgshJTutnwWJS6",
          "name": "google drive tech"
        }
      }
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "triggerOn": "specificFolder",
        "folderToWatch": {
          "__rl": true,
          "value": "1wO982KY2_RtrzN9iRO7ZikoKEUIMdXmo",
          "mode": "id"
        },
        "event": "fileCreated",
        "options": {}
      },
      "type": "n8n-nodes-base.googleDriveTrigger",
      "typeVersion": 1,
      "position": [
        -640,
        -1056
      ],
      "id": "d1d65c5b-34ee-403d-bd33-17da2afc181e",
      "name": "rc geral | created1",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "lUbgshJTutnwWJS6",
          "name": "google drive tech"
        }
      }
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "triggerOn": "specificFolder",
        "folderToWatch": {
          "__rl": true,
          "value": "1wO982KY2_RtrzN9iRO7ZikoKEUIMdXmo",
          "mode": "id"
        },
        "event": "fileUpdated",
        "options": {}
      },
      "type": "n8n-nodes-base.googleDriveTrigger",
      "typeVersion": 1,
      "position": [
        -640,
        -896
      ],
      "id": "c2ab865b-fcef-485b-bb77-df910b398d73",
      "name": "rc geral | updated",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "lUbgshJTutnwWJS6",
          "name": "google drive tech"
        }
      }
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "triggerOn": "specificFolder",
        "folderToWatch": {
          "__rl": true,
          "value": "1VRJD5xIm3Mt8E0ve-s7q6kqUdmc6RzeZ",
          "mode": "id"
        },
        "event": "fileCreated",
        "options": {}
      },
      "type": "n8n-nodes-base.googleDriveTrigger",
      "typeVersion": 1,
      "position": [
        -656,
        -608
      ],
      "id": "d9f50ff7-204f-4a2f-a078-1a2236bc0f61",
      "name": "rc profissional | created",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "lUbgshJTutnwWJS6",
          "name": "google drive tech"
        }
      }
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "triggerOn": "specificFolder",
        "folderToWatch": {
          "__rl": true,
          "value": "1VRJD5xIm3Mt8E0ve-s7q6kqUdmc6RzeZ",
          "mode": "id"
        },
        "event": "fileUpdated",
        "options": {}
      },
      "type": "n8n-nodes-base.googleDriveTrigger",
      "typeVersion": 1,
      "position": [
        -656,
        -448
      ],
      "id": "b256b047-6bb7-4a8d-b4e6-bba06ebc4788",
      "name": "rc profissional | updated",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "lUbgshJTutnwWJS6",
          "name": "google drive tech"
        }
      }
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "triggerOn": "specificFolder",
        "folderToWatch": {
          "__rl": true,
          "value": "1G8HielyNDdcmL9HDWunSbAtO658GZpsH",
          "mode": "id"
        },
        "event": "fileCreated",
        "options": {}
      },
      "type": "n8n-nodes-base.googleDriveTrigger",
      "typeVersion": 1,
      "position": [
        -1856,
        -1408
      ],
      "id": "97d95223-40b7-453d-9d7c-648f40da788f",
      "name": "sinistro | created1",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "lUbgshJTutnwWJS6",
          "name": "google drive tech"
        }
      }
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "triggerOn": "specificFolder",
        "folderToWatch": {
          "__rl": true,
          "value": "1G8HielyNDdcmL9HDWunSbAtO658GZpsH",
          "mode": "id"
        },
        "event": "fileUpdated",
        "options": {}
      },
      "type": "n8n-nodes-base.googleDriveTrigger",
      "typeVersion": 1,
      "position": [
        -1664,
        -1408
      ],
      "id": "9e613a61-40b3-42b4-bac2-4733ddcdb0a5",
      "name": "sinistro | updated",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "lUbgshJTutnwWJS6",
          "name": "google drive tech"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "Olá! Me desculpe mas não consigo responder essa pergunta, tente algo relacionado a seguros! :)",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        2016,
        1232
      ],
      "id": "4b949f82-f443-46da-adb5-23708356c12a",
      "name": "Responda com erro:"
    },
    {
      "parameters": {
        "options": {
          "batchSize": 128,
          "stripNewLines": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        1840,
        32
      ],
      "id": "5e53843e-9709-4889-bfca-a71f0788a1cd",
      "name": "Embeddings OpenAI3",
      "credentials": {
        "openAiApi": {
          "id": "6XodQNiVwLbmQE7G",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "chunkSize": 1200,
        "options": {
          "splitCode": "markdown"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter",
      "typeVersion": 1,
      "position": [
        1984,
        32
      ],
      "id": "d9805ddd-2daf-4461-a503-09e6b47ed9af",
      "name": "Recursive Character Text Splitter1"
    },
    {
      "parameters": {
        "jsonMode": "expressionData",
        "jsonData": "={{ $json.data }}",
        "options": {
          "metadata": {
            "metadataValues": [
              {
                "name": "file_id",
                "value": "={{ $('set file_id1').item.json.file_id }}"
              }
            ]
          }
        }
      },
      "id": "2159f628-db0a-4bcb-a5ab-7137cad99548",
      "name": "Default Data Loader1",
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "position": [
        2096,
        -64
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "8c1249ba-2270-49da-867b-6986173ac1e5",
                    "leftValue": "={{ $json.output }}",
                    "rightValue": "Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos?",
                    "operator": {
                      "type": "string",
                      "operation": "notContains"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.output }}",
                    "rightValue": "=Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos?",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    },
                    "id": "28368e6f-2c26-4be0-ae11-8150b413a47c"
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        1104,
        1536
      ],
      "id": "ce682326-f826-4cdf-862b-942b2579e33b",
      "name": "fallback1"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "8c1249ba-2270-49da-867b-6986173ac1e5",
                    "leftValue": "={{ $json.output }}",
                    "rightValue": "Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos?",
                    "operator": {
                      "type": "string",
                      "operation": "notContains"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.output }}",
                    "rightValue": "=Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos?",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    },
                    "id": "28368e6f-2c26-4be0-ae11-8150b413a47c"
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        144,
        1584
      ],
      "id": "86b16eb5-f3af-49e0-901d-eb43550d6a08",
      "name": "fallback4"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Webhook').item.json.body.model }}",
                    "rightValue": "=global",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "9029d89d-b37d-4309-a4f3-d9e9151d5098"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "1b3accbd-0f46-4bcb-b382-1c8c201912a2",
                    "leftValue": "={{ $('Webhook').item.json.body.model }}",
                    "rightValue": "d&o",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "e64520c7-f871-42d0-bc1b-e367ca7e5c85",
                    "leftValue": "={{ $('Webhook').item.json.body.model }}",
                    "rightValue": "rc-geral",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "dcd2db64-4250-45bf-ba24-78ea75b3e316",
                    "leftValue": "={{ $('Webhook').item.json.body.model }}",
                    "rightValue": "rc-profissional",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -544,
        1376
      ],
      "id": "e68967c3-be67-4b59-b20d-d5ef5e9401d2",
      "name": "Switch1"
    },
    {
      "parameters": {
        "content": "## D&O",
        "height": 560,
        "width": 1360
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -368,
        1568
      ],
      "typeVersion": 1,
      "id": "06cb0f03-2632-4119-809f-1378e13434b7",
      "name": "Sticky Note14"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Webhook').item.json.body.model }}",
                    "rightValue": "=global",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "9029d89d-b37d-4309-a4f3-d9e9151d5098"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "1b3accbd-0f46-4bcb-b382-1c8c201912a2",
                    "leftValue": "={{ $('Webhook').item.json.body.model }}",
                    "rightValue": "basic",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -544,
        448
      ],
      "id": "869d1ecb-d179-46e5-8997-1e0234d8b895",
      "name": "Switch2"
    },
    {
      "parameters": {
        "content": "## GLOBAL",
        "height": 512,
        "width": 1360,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -368,
        1040
      ],
      "typeVersion": 1,
      "id": "91589739-2dc5-4301-bf0b-9b742cd1fe8c",
      "name": "Sticky Note15"
    },
    {
      "parameters": {
        "content": "## BASICO",
        "height": 384,
        "width": 1360
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -368,
        640
      ],
      "typeVersion": 1,
      "id": "6d885e97-cdeb-4811-9f90-a78dcc37c005",
      "name": "Sticky Note16"
    },
    {
      "parameters": {
        "content": "## GLOBAL",
        "height": 400,
        "width": 1360,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -368,
        224
      ],
      "typeVersion": 1,
      "id": "d419e996-6451-41b0-911e-22a9fc3a554f",
      "name": "Sticky Note17"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "9uHL3bFNJzfl1BR4",
          "mode": "list",
          "cachedResultName": "agente-basico-main"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "output": "={{ $json.output }}"
          },
          "matchingColumns": [
            "output"
          ],
          "schema": [
            {
              "id": "output",
              "displayName": "output",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.2,
      "position": [
        4144,
        352
      ],
      "name": "Call agente-basic-reranker",
      "id": "96ceecd5-eb69-41e9-bd5f-ccea72a7dae5"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "mmJnBOSPYKNaNDJv",
          "mode": "list"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "output": "={{ $json.output }}"
          },
          "matchingColumns": [
            "output"
          ],
          "schema": [
            {
              "id": "output",
              "displayName": "output",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.2,
      "position": [
        4480,
        368
      ],
      "name": "Call agente-basic-fallback",
      "id": "f2ecb8f8-a95c-4859-9b20-22f327de1435"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "VWjmsah5W4ziYGN2",
          "mode": "list"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "sessionId": "={{ $('get sessionId && userId').item.json.sessionId }}",
            "userId": "={{ $('get sessionId && userId').item.json.userId }}",
            "body_message": "={{ $('Webhook').item.json.body.message }}"
          },
          "matchingColumns": [
            "sessionId",
            "userId",
            "body_message"
          ],
          "schema": [
            {
              "id": "sessionId",
              "displayName": "sessionId",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "userId",
              "displayName": "userId",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "body_message",
              "displayName": "body_message",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.2,
      "position": [
        4496,
        -112
      ],
      "name": "Call agente-pdf-global",
      "id": "d044e390-58b9-42eb-8dc8-eae81957fec2"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "g28hEzuEE9pTNPtG",
          "mode": "list"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "sessionId": "={{ $('get sessionId && userId').item.json.sessionId }}",
            "userId": "={{ $('get sessionId && userId').item.json.userId }}",
            "body_message": "={{ $('Webhook').item.json.body.message }}"
          },
          "matchingColumns": [
            "sessionId",
            "userId",
            "body_message"
          ],
          "schema": [
            {
              "id": "sessionId",
              "displayName": "sessionId",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "userId",
              "displayName": "userId",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "body_message",
              "displayName": "body_message",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.2,
      "position": [
        4192,
        -64
      ],
      "name": "Call agente-pdf-basic",
      "id": "17647e38-151c-4556-874f-3778d82541b4"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "Uv7O1s0AL1Y22IWK",
          "mode": "list"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "output": "={{ $json.output }}"
          },
          "matchingColumns": [
            "output"
          ],
          "schema": [
            {
              "id": "output",
              "displayName": "output",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.2,
      "position": [
        4160,
        160
      ],
      "name": "Call agente-global-RERANKER",
      "id": "cc030f30-3d39-43cd-bd89-598a71b609cf"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "HlvmXGcken4FlP3J",
          "mode": "list",
          "cachedResultName": "agente-falback-basic"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "output": "={{ $json.output }}"
          },
          "matchingColumns": [
            "output"
          ],
          "schema": [
            {
              "id": "output",
              "displayName": "output",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.2,
      "position": [
        4480,
        144
      ],
      "name": "Call agente-falback-basic-global",
      "id": "00438fa7-e060-4b1a-8266-22fda76e9786"
    },
    {
      "parameters": {
        "content": "## resposta final",
        "height": 336,
        "width": 242,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2128,
        240
      ],
      "typeVersion": 1,
      "id": "af832599-1d59-4bc8-b1ed-1023c2688414",
      "name": "Sticky Note8"
    },
    {
      "parameters": {
        "content": "## seletor modelo",
        "height": 1504,
        "width": 242,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -624,
        368
      ],
      "typeVersion": 1,
      "id": "d692c507-f9eb-45e0-91d8-5a94be629c5a",
      "name": "Sticky Note9"
    },
    {
      "parameters": {
        "modelName": "rerank-multilingual-v3.0",
        "topN": 7
      },
      "type": "@n8n/n8n-nodes-langchain.rerankerCohere",
      "typeVersion": 1,
      "position": [
        -64,
        1872
      ],
      "id": "104d3639-724b-4bc4-89f6-3af128f42378",
      "name": "Reranker Cohere",
      "credentials": {
        "cohereApi": {
          "id": "S13muyow0gTEETIc",
          "name": "CohereApi produção"
        }
      }
    },
    {
      "parameters": {
        "options": {
          "batchSize": 300,
          "stripNewLines": true
        }
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        -160,
        1984
      ],
      "id": "57d47d87-5c56-43b3-a00f-bf53bfe340be",
      "name": "Embeddings OpenAI6",
      "credentials": {
        "openAiApi": {
          "id": "6XodQNiVwLbmQE7G",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "You are a Retrieval-Augmented Generation (RAG) assistant specialized in insurance, integrated with a vector store containing all documents, policies, PDFs, spreadsheets, and transcripts provided by the user, as well as text documents.\n\nMandatory workflow before answering\nInsurance-focused similarity search\n\nCreate an embedding of the user’s question.\n\nQuery the vector store, prioritizing precise insurance terms (for example: “LMG”, “retroatividade” [retroactivity], “franquia” [deductible], “sinistro” [claim], “D&O”, “Professional Liability”, etc.).\n\nApply extra reinforcement for recognized synonyms or acronyms.\n\nEvidence retrieval\nRetrieve exactly 5 most relevant excerpts.\n\nIf the similarity search results in no relevant information or the retrieved facts are not sufficient to answer, respond with:\n“Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos?”\n\nIf multiple source types exist (e.g., PDF vs. transcript), ensure diversity — at least one excerpt of each type when available.\n\nFor each excerpt, keep: text, document title, and page number or timestamp.\n\nReading and synthesis\nRead all 5 excerpts, extracting: policy types, coverages, exclusions, limits, effective dates, retroactivity, deductibles, post-claim obligations, etc.\n\nSynthesize the information across excerpts; resolve conflicts by source hierarchy (policy text > endorsement > transcript).\n\nAnswer construction\nThe answer must begin with a direct and clear summary, strictly based on the documents, using insurance terminology.\n\nThen, develop the explanation with technical details and evidence. Do not cite the retrieved excerpts inline with the text. Instead, collect all citations and list them at the end of the answer under a separate heading, such as \"Fontes\" or \"Evidências\".\n\nEnd with a practical suggestion or follow-up question to keep the interaction (e.g.: “Would you like to simulate the impact of increasing the LMG?”).\n\nDo not use labels such as “First paragraph”, “Next” or “Finally”. The response must be continuous and natural.\n\nInsufficient evidence\nIf the reading and synthesis step results in inadequate information or if there are no sufficient facts to answer the user's question, respond with:\n“Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos?”\n\nNever guess or invent information.\n\nSpecial command /learn:\nIf the user’s message starts with /insert:\n\nRespond only:\n“Content received. I will add it to the knowledge base.”\n\nDo not perform retrieval or apply response structure.\n\nAn external system will handle ingestion and incorporation.\n\nGeneral rules\nNever use information outside of the 5 retrieved excerpts.\n\nDo not make assumptions; explicitly state when something is absent in the documents.\n\nMaintain consistent terminology (for example: always “retroatividade” [retroactivity], not “lookback period”; always use “LMG” for Liability Limit).\n\nAll responses must be in Portuguese (pt-br), except for standard industry abbreviations (D&O, E&O, etc.).",
        "tableName": {
          "__rl": true,
          "value": "d_o",
          "mode": "list",
          "cachedResultName": "d_o"
        },
        "topK": 13,
        "useReranker": true,
        "options": {
          "queryName": "match_d_o"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        -160,
        1760
      ],
      "id": "de95ec9c-3750-48c5-b199-aa3fcf00fbae",
      "name": "retrieval_tool1",
      "credentials": {
        "supabaseApi": {
          "id": "4PGtFDuqvBvB3tvc",
          "name": "supabase VPS"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -272,
        1760
      ],
      "id": "a827c654-3845-4d73-88cc-73d4af4bbd0e",
      "name": "gemini-2.5-flash1",
      "credentials": {
        "googlePalmApi": {
          "id": "3JiV6rPIxvxjMpnY",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        -304,
        2464
      ],
      "id": "3109eb87-7f9a-4573-b1fd-3f8474b7b1b5",
      "name": "Postgres Chat Memory",
      "credentials": {
        "postgres": {
          "id": "Pacsdm5ViP161v2q",
          "name": "Postgres vps 2"
        }
      }
    },
    {
      "parameters": {
        "name": "user_documents",
        "description": "Base de conhecimento sobre seguros de responsabilidade civil.  \nContém transcrições de aulas, materiais de treinamento, trechos de apólices, cláusulas, exclusões, exemplos de sinistros reais e orientações práticas para corretores.  \nAbrange temas como: retroatividade, LMG, franquia, POS, D&O, E&O, contratação, sinistros, coberturas e condições gerais.  \n",
        "topK": 5
      },
      "id": "65a1cd49-32c6-4e91-a59a-b8b8bdea6f1f",
      "name": "Vector Store Tool2",
      "type": "@n8n/n8n-nodes-langchain.toolVectorStore",
      "typeVersion": 1,
      "position": [
        736,
        1728
      ]
    },
    {
      "parameters": {
        "tableName": {
          "__rl": true,
          "value": "d_o",
          "mode": "list",
          "cachedResultName": "d_o"
        },
        "options": {
          "queryName": "match_d_o"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        736,
        1840
      ],
      "id": "a3d0ffb7-29bf-4eb6-93a0-defd21dbfe52",
      "name": "Supabase Vector Store4",
      "credentials": {
        "supabaseApi": {
          "id": "4PGtFDuqvBvB3tvc",
          "name": "supabase VPS"
        }
      }
    },
    {
      "parameters": {
        "options": {
          "batchSize": 300
        }
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        752,
        1936
      ],
      "id": "ee4bf094-cb21-463f-9da3-988f12ece980",
      "name": "Embeddings OpenAI5",
      "credentials": {
        "openAiApi": {
          "id": "6XodQNiVwLbmQE7G",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5",
          "mode": "list",
          "cachedResultName": "gpt-5"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        640,
        1792
      ],
      "id": "a5cfb014-279a-4e64-9346-7ea285efbcc3",
      "name": "OpenAI Chat Model4",
      "credentials": {
        "openAiApi": {
          "id": "6XodQNiVwLbmQE7G",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5",
          "mode": "list",
          "cachedResultName": "gpt-5"
        },
        "options": {
          "timeout": 600000
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        896,
        1952
      ],
      "id": "adb6e6c0-f229-4475-8f21-e0b4fb814cc3",
      "name": "gpt--",
      "credentials": {
        "openAiApi": {
          "id": "6XodQNiVwLbmQE7G",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.output }}",
        "options": {
          "systemMessage": "Você é um assistente de seguros que opera exclusivamente com os trechos retornados pela retrieval_tool (banco “base de conhecimento sobre seguros de responsabilidade civil”).\nNunca use informações de fora dessa base. Ignore qualquer campo “response” que venha da ferramenta de busca; use apenas os trechos crus (pageContent + metadata).\n\nPrincípios (travas)\n\nFonte única: somente os trechos recebidos.\n\nRastreabilidade obrigatória: toda afirmação deve estar coberta pelos trechos e acompanhar citação compacta ao fim do parágrafo ou item.\n\n80/20 rígido: ≥ 80% do texto deve ser citação literal ou colagem mínima dos trechos (permitido […]). Até 20% pode ser síntese curta apenas para ligar ideias já citadas, com citação no final do parágrafo.\n\nSem conteúdo novo: proíbe exemplos, recomendações, números, condições, definições ou conclusões que não estejam literalmente nos trechos.\n\nMetadados ausentes (tolerância)\n\nSe metadata.file ou metadata.trecho não existirem:\n\nExtraia Nome_do_arquivo de uma linha iniciada por Titulo: dentro do pageContent (remova vírgulas e espaços finais).\n\nExtraia o número X a partir do padrão trecho <número> no pageContent.\n\nSe não encontrar, use (trecho ?, Arquivo_desconhecido).\n\nFormato de saída (fixo)\n\nResponda sempre com estas seções:\n\nResposta direta\nAté 2 frases que respondem objetivamente à pergunta, usando apenas ideias presentes nos trechos. Termine o parágrafo com citações compactas:\n(trecho X, Nome; trecho Y, Nome; …)\n\nCitações de suporte\n\n“Citação literal ou colagem mínima [...]” — (trecho X, Nome)\n\n“Citação literal ou colagem mínima [...]” — (trecho Y, Nome)\n\n(adicione quantas forem necessárias para sustentar integralmente a Resposta direta)\n\nFontes\n\n(trecho X, Nome)\n\n(trecho Y, Nome)\n\n(liste uma vez cada fonte usada; sem duplicatas)\n\nEstilo: use negrito apenas em títulos fixos acima; o corpo pode usar negrito pontual para realçar termos que já aparecem nos trechos (ex.: valores, expressões-chave).\n\nRegras de resposta\n\nSaudações curtas (“oi”, “olá”, “bom dia”, “boa tarde”, “boa noite”, “opa”, “salve”, “tudo bem?”): responda apenas “Olá! 👋” sem consultar a retrieval_tool.\n\nQualquer outra mensagem: siga o formato acima; não crie seções extras.\n\nFalta de base literal: se os trechos forem ausentes, insuficientes, contraditórios ou não sustentarem a resposta literalmente, responda exatamente:\n“Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos?”\n\nProibições absolutas\n\n❌ Conhecimento externo, inferências, “boas práticas”, conselhos genéricos.\n\n❌ Mencionar pipeline (vetor, RAG, embedding, documentos recuperados).\n\n❌ Alterar termos/siglas do mercado (retroatividade, LMG, D&O, E&O etc.).\n\n❌ Citar arquivos/trechos não presentes nos dados recebidos (aplique a tolerância descrita).\n\nAuto-checagem (antes de enviar)\n\nA Resposta direta tem no máx. 2 frases e termina com citações compactas?\n\n≥ 80% do texto total são citações literais/colagens dos trechos?\n\nAs Citações de suporte são literais/colagens e cada linha tem citação?\n\nA seção Fontes lista cada fonte usada uma única vez?\n\nNão há nada que não esteja nos trechos?\nSe alguma resposta for “não”, envie a mensagem padrão de falta de informação.\n\nObservação muito importante, se o usuário lhe fazer uma pergunta sobre outro ramo que não seja D&O, por exemplo RC Profissional (E&O) ou até mesmo conhecimentos gerais, ou sobre outros nichos que não tem nada haver com Seguros E&O, responda com a mensagem : \"Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos? Pergunte algo relacionado a seguros D&O\"",
          "returnIntermediateSteps": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        672,
        1584
      ],
      "id": "0cb63ab0-fce8-4cc0-8b9c-604d46cd7c60",
      "name": "AGENTE basico fallback 1"
    },
    {
      "parameters": {
        "modelName": "rerank-multilingual-v3.0",
        "topN": 13
      },
      "type": "@n8n/n8n-nodes-langchain.rerankerCohere",
      "typeVersion": 1,
      "position": [
        0,
        1344
      ],
      "id": "6be3b13f-f76f-4ba8-8a20-99282909865e",
      "name": "Reranker Cohere1",
      "credentials": {
        "cohereApi": {
          "id": "S13muyow0gTEETIc",
          "name": "CohereApi produção"
        }
      }
    },
    {
      "parameters": {
        "options": {
          "batchSize": 300,
          "stripNewLines": true
        }
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        -128,
        1408
      ],
      "id": "a1797217-60ea-4f04-855b-475022336dbc",
      "name": "Embeddings OpenAI4",
      "credentials": {
        "openAiApi": {
          "id": "6XodQNiVwLbmQE7G",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -256,
        1216
      ],
      "id": "67f0c14f-d0fd-4a3d-afd0-fa141c4094fd",
      "name": "gemini-2.5-flash",
      "credentials": {
        "googlePalmApi": {
          "id": "3JiV6rPIxvxjMpnY",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "You are a Retrieval-Augmented Generation (RAG) assistant specialized in insurance, integrated with a vector store containing all documents, policies, PDFs, spreadsheets, and transcripts provided by the user, as well as text documents.\n\nMandatory workflow before answering\nInsurance-focused similarity search\n\nCreate an embedding of the user’s question.\n\nQuery the vector store, prioritizing precise insurance terms (for example: “LMG”, “retroatividade” [retroactivity], “franquia” [deductible], “sinistro” [claim], “D&O”, “Professional Liability”, etc.).\n\nApply extra reinforcement for recognized synonyms or acronyms.\n\nEvidence retrieval\nRetrieve exactly 5 most relevant excerpts.\n\nIf the similarity search results in no relevant information or the retrieved facts are not sufficient to answer, respond with:\n“Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos?”\n\nIf multiple source types exist (e.g., PDF vs. transcript), ensure diversity — at least one excerpt of each type when available.\n\nFor each excerpt, keep: text, document title, and page number or timestamp.\n\nReading and synthesis\nRead all 5 excerpts, extracting: policy types, coverages, exclusions, limits, effective dates, retroactivity, deductibles, post-claim obligations, etc.\n\nSynthesize the information across excerpts; resolve conflicts by source hierarchy (policy text > endorsement > transcript).\n\nAnswer construction\nThe answer must begin with a direct and clear summary, strictly based on the documents, using insurance terminology.\n\nThen, develop the explanation with technical details and evidence. Do not cite the retrieved excerpts inline with the text. Instead, collect all citations and list them at the end of the answer under a separate heading, such as \"Fontes\" or \"Evidências\".\n\nEnd with a practical suggestion or follow-up question to keep the interaction (e.g.: “Would you like to simulate the impact of increasing the LMG?”).\n\nDo not use labels such as “First paragraph”, “Next” or “Finally”. The response must be continuous and natural.\n\nInsufficient evidence\nIf the reading and synthesis step results in inadequate information or if there are no sufficient facts to answer the user's question, respond with:\n“Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos?”\n\nNever guess or invent information.\n\nSpecial command /learn:\nIf the user’s message starts with /insert:\n\nRespond only:\n“Content received. I will add it to the knowledge base.”\n\nDo not perform retrieval or apply response structure.\n\nAn external system will handle ingestion and incorporation.\n\nGeneral rules\nNever use information outside of the 5 retrieved excerpts.\n\nDo not make assumptions; explicitly state when something is absent in the documents.\n\nMaintain consistent terminology (for example: always “retroatividade” [retroactivity], not “lookback period”; always use “LMG” for Liability Limit).\n\nAll responses must be in Portuguese (pt-br), except for standard industry abbreviations (D&O, E&O, etc.).",
        "tableName": {
          "__rl": true,
          "value": "documents",
          "mode": "list",
          "cachedResultName": "documents"
        },
        "topK": 13,
        "useReranker": true,
        "options": {
          "queryName": "match_documents"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        -128,
        1232
      ],
      "id": "a0816363-3836-41b1-ac41-ec2f8c93fed8",
      "name": "retrieval_tool",
      "credentials": {
        "supabaseApi": {
          "id": "4PGtFDuqvBvB3tvc",
          "name": "supabase VPS"
        }
      }
    },
    {
      "parameters": {
        "name": "user_documents",
        "description": "Base de conhecimento sobre seguros de responsabilidade civil.  \nContém transcrições de aulas, materiais de treinamento, trechos de apólices, cláusulas, exclusões, exemplos de sinistros reais e orientações práticas para corretores.  \nAbrange temas como: retroatividade, LMG, franquia, POS, D&O, E&O, contratação, sinistros, coberturas e condições gerais.  \n",
        "topK": 5
      },
      "id": "5eea7965-d6db-4811-83b8-d2878ee59ad5",
      "name": "Vector Store Tool",
      "type": "@n8n/n8n-nodes-langchain.toolVectorStore",
      "typeVersion": 1,
      "position": [
        736,
        1232
      ]
    },
    {
      "parameters": {
        "tableName": {
          "__rl": true,
          "value": "documents",
          "mode": "list",
          "cachedResultName": "documents"
        },
        "options": {
          "queryName": "match_documents"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        736,
        1328
      ],
      "id": "60e71c33-c527-4663-a3cb-c16280977951",
      "name": "Supabase Vector Store1",
      "credentials": {
        "supabaseApi": {
          "id": "4PGtFDuqvBvB3tvc",
          "name": "supabase VPS"
        }
      }
    },
    {
      "parameters": {
        "options": {
          "batchSize": 300
        }
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        752,
        1424
      ],
      "id": "0e06429e-6467-46a8-ab52-dcdd62304ada",
      "name": "Embeddings OpenAI",
      "credentials": {
        "openAiApi": {
          "id": "6XodQNiVwLbmQE7G",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5",
          "mode": "list",
          "cachedResultName": "gpt-5"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        608,
        1232
      ],
      "id": "71ffc11e-576e-46d1-9be9-34e847ddf2c0",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "6XodQNiVwLbmQE7G",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5",
          "mode": "list",
          "cachedResultName": "gpt-5"
        },
        "options": {
          "timeout": 600000
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        880,
        1424
      ],
      "id": "7244b639-d183-49ff-a2e6-5611ab3ed188",
      "name": "gpt--5",
      "credentials": {
        "openAiApi": {
          "id": "6XodQNiVwLbmQE7G",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.output }}",
        "options": {
          "systemMessage": "Você é um assistente de seguros. Para cada mensagem do usuário, sempre chame retrieval_tool com a pergunta e construa a resposta somente a partir dos trechos retornados. Não mencione documentos, busca, base vetorial ou mecanismos internos.\nSe as evidências não forem suficientes para responder com segurança, responda apenas: “Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos?”\nFormatação: títulos no mesmo bloco com ** ** e quebra simples \\n. Terminologia: “retroatividade”, “LMG”; manter D&O e E&O. Responda sempre em português.\n\nSem convites de busca: não oferecer “posso buscar/confirmar nos seus documentos”. A consulta já foi feita internamente.\n\nSem meta-comentários: não usar frases como “baseado nos seus documentos”, “trecho recuperado”, “RAG”, “vetor”, “embedding” ou equivalentes.\n\nse a conversa iniciar com a palavra \"/insert\", você deve responder apenas \"Conteúdo adicionado a base de conhecimentos\" sem consultar o banco vetorial\n\nse a pergunta conter palavras como 'Refinaria, Barril, Reservatório, Plataforma, Derivados, Petroquímica, Petrolífera, Petroleira' sugira o usuário a consultar a seguradora , responda algo como \"Infelizmente, por se tratar de informações importantes e específicas, recomendo que você consulte diretamente a seguradora para obter os detalhes mais precisos e atualizados.\"",
          "returnIntermediateSteps": true
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        -192,
        1056
      ],
      "id": "9241adb7-1cc5-43c3-a318-8039eed19280",
      "name": "AGENTE global reranker 2"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.output }}",
        "options": {
          "systemMessage": "Você é um assistente de seguros que opera exclusivamente com os trechos retornados pela retrieval_tool (banco “base de conhecimento sobre seguros de responsabilidade civil”).\nNunca use informações de fora dessa base. Ignore qualquer campo “response” que venha da ferramenta de busca; use apenas os trechos crus (pageContent + metadata).\n\nPrincípios (travas)\n\nFonte única: somente os trechos recebidos.\n\nRastreabilidade obrigatória: toda afirmação deve estar coberta pelos trechos e acompanhar citação compacta ao fim do parágrafo ou item.\n\n80/20 rígido: ≥ 80% do texto deve ser citação literal ou colagem mínima dos trechos (permitido […]). Até 20% pode ser síntese curta apenas para ligar ideias já citadas, com citação no final do parágrafo.\n\nSem conteúdo novo: proíbe exemplos, recomendações, números, condições, definições ou conclusões que não estejam literalmente nos trechos.\n\nMetadados ausentes (tolerância)\n\nSe metadata.file ou metadata.trecho não existirem:\n\nExtraia Nome_do_arquivo de uma linha iniciada por Titulo: dentro do pageContent (remova vírgulas e espaços finais).\n\nExtraia o número X a partir do padrão trecho <número> no pageContent.\n\nSe não encontrar, use (trecho ?, Arquivo_desconhecido).\n\nFormato de saída (fixo)\n\nResponda sempre com estas seções:\n\nResposta direta\nAté 2 frases que respondem objetivamente à pergunta, usando apenas ideias presentes nos trechos. Termine o parágrafo com citações compactas:\n(trecho X, Nome; trecho Y, Nome; …)\n\nCitações de suporte\n\n“Citação literal ou colagem mínima [...]” — (trecho X, Nome)\n\n“Citação literal ou colagem mínima [...]” — (trecho Y, Nome)\n\n(adicione quantas forem necessárias para sustentar integralmente a Resposta direta)\n\nFontes\n\n(trecho X, Nome)\n\n(trecho Y, Nome)\n\n(liste uma vez cada fonte usada; sem duplicatas)\n\nEstilo: use negrito apenas em títulos fixos acima; o corpo pode usar negrito pontual para realçar termos que já aparecem nos trechos (ex.: valores, expressões-chave).\n\nRegras de resposta\n\nSaudações curtas (“oi”, “olá”, “bom dia”, “boa tarde”, “boa noite”, “opa”, “salve”, “tudo bem?”): responda apenas “Olá! 👋” sem consultar a retrieval_tool.\n\nQualquer outra mensagem: siga o formato acima; não crie seções extras.\n\nFalta de base literal: se os trechos forem ausentes, insuficientes, contraditórios ou não sustentarem a resposta literalmente, responda exatamente:\n“Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos?”\n\nProibições absolutas\n\n❌ Conhecimento externo, inferências, “boas práticas”, conselhos genéricos.\n\n❌ Mencionar pipeline (vetor, RAG, embedding, documentos recuperados).\n\n❌ Alterar termos/siglas do mercado (retroatividade, LMG, D&O, E&O etc.).\n\n❌ Citar arquivos/trechos não presentes nos dados recebidos (aplique a tolerância descrita).\n\nAuto-checagem (antes de enviar)\n\nA Resposta direta tem no máx. 2 frases e termina com citações compactas?\n\n≥ 80% do texto total são citações literais/colagens dos trechos?\n\nAs Citações de suporte são literais/colagens e cada linha tem citação?\n\nA seção Fontes lista cada fonte usada uma única vez?\n\nNão há nada que não esteja nos trechos?\nSe alguma resposta for “não”, envie a mensagem padrão de falta de informação.",
          "returnIntermediateSteps": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        704,
        1072
      ],
      "id": "ee43c98d-d8e5-4632-be3b-e512d607307c",
      "name": "AGENTE global fallback 2"
    },
    {
      "parameters": {
        "operation": "pdf",
        "binaryPropertyName": "file",
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        -240,
        672
      ],
      "id": "e87b78f2-b4d7-49d6-ab03-c0f62949f76c",
      "name": "Extrai Texto1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "d5bceaf7-31f1-4a8e-bfb7-30701681e837",
              "name": "output",
              "value": "={{ $('Start').item.json.sessionId }},{{ $('Start').item.json.userId }} : {{ $json.text }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -80,
        672
      ],
      "id": "8bc810f3-8c05-4430-83c7-39f59c87d1ba",
      "name": "formata o titulo {{}} para o Agente1"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        384,
        880
      ],
      "id": "d8a41c27-a5c6-4d1b-8e5d-d5fd1e5852d1",
      "name": "Google Gemini Chat Model4",
      "credentials": {
        "googlePalmApi": {
          "id": "3JiV6rPIxvxjMpnY",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        112,
        800
      ],
      "id": "c11030bf-a49f-4d9e-9b06-de1e842f2194",
      "name": "Google Gemini Chat Model5",
      "credentials": {
        "googlePalmApi": {
          "id": "3JiV6rPIxvxjMpnY",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "name": "user_documents",
        "description": "Contexto do acervo (fonte de verdade): este workspace reúne todo o material necessário para responder: apólices, condições gerais e cláusulas, leis e normas enviadas pelo usuário, resumos de vídeos, transcrições, planilhas e anotações. Trate esse acervo como a única fonte autorizada. É proibido responder sem consultar a base vetorial. Em caso de falha na recuperação, não inferir, não completar lacunas e não usar conhecimento externo.\n\nVocê é um assistente especialista em seguros, integrado a uma base vetorial contendo todos os documentos, apólices, PDFs, planilhas e transcrições fornecidos pelo usuário, além de textos adicionais.\n\nFluxo obrigatório antes de responder\nBusca com foco em seguros\n\nCriar um embedding da pergunta do usuário.\n\nConsultar a base vetorial priorizando termos técnicos de seguros (ex.: LMG, retroatividade, franquia, sinistro, D&O, E&O).\n\nReforçar sinônimos, variações e abreviações reconhecidas.\n\nReclassificar os resultados combinando pontuação de similaridade e presença de termos técnicos.\n\nGate RAG: se não houver evidências suficientes para responder com segurança, acionar a regra “Quando não houver informação suficiente”.\n\nRecuperação de evidências\n\nRecuperar a quantidade necessária de trechos, até um máximo de 5, priorizando qualidade e cobertura do tema.\n\nSe houver múltiplos tipos de fonte (ex.: PDF e transcrição), garantir diversidade com pelo menos um de cada quando disponível.\n\nPara cada trecho, registrar internamente: texto, título do documento e página ou timestamp.\n\nNão expor metadados técnicos nem o mecanismo de recuperação. Não usar rótulos como “trecho recuperado”, “fonte”, “observação”, “RAG”, “vetor”, “embedding”.\n\nLeitura e síntese\n\nLer os trechos recuperados e extrair: tipo de apólice, coberturas, exclusões, limites, vigência, retroatividade, franquias, obrigações pós-sinistro.\n\nSintetizar integrando as evidências e resolver conflitos pela hierarquia: apólice > endosso > transcrição.\n\nCheque de consistência: remover qualquer afirmação que não esteja explicitamente suportada pelos trechos utilizados.\n\nConstrução da resposta\nResumo: iniciar com um resumo direto e claro, baseado nos documentos, usando terminologia técnica de seguros\nDetalhamento técnico com evidências: desenvolver a explicação citando os trechos efetivamente utilizados, de forma discreta e natural, indicando apenas título do documento e página ou timestamp entre parênteses. Ex.: (Condições Gerais RC Profissional, p. 12) ou (Reunião Comitê, 00:13:45)\nEncerramento prático: concluir com uma sugestão de próximo passo ou pergunta de continuidade. Ex.: “Quer avaliar o impacto de aumentar o LMG?”\n\nNão usar marcadores como “Primeiro”, “Depois” ou “Por fim”.\n\nO texto deve ser contínuo, natural e didático.\n\nQuando não houver informação suficiente\nSe, após a recuperação e leitura, as evidências não forem suficientes para responder com segurança:\n“Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos?”\n\nNunca adivinhar ou inventar dados.\n\nNão responder sobre o tema sem evidências.\n\nComando especial /insert\nSe a mensagem do usuário começar com /insert, responder apenas:\n“Conteúdo recebido. Vou adicionar à base de conhecimento.”\n\nNão realizar busca nem aplicar a estrutura de resposta.\n\nA ingestão será feita por um sistema externo.\n\nRegras gerais de formatação e terminologia\n\nTítulos e seções no mesmo bloco: ao iniciar uma nova seção, colocar as primeiras palavras em negrito com ** ** e continuar o texto no mesmo bloco, usando apenas uma quebra de linha simples \\n. Ex.: Coberturas: descrição contínua no mesmo parágrafo. Opcionalmente, pode-se usar itálico em vez de negrito.\n\nCitações das evidências: somente título do documento e página ou timestamp entre parênteses, sem links ou rótulos explicativos.\n\nEscopo das fontes: nunca usar informação fora dos trechos recuperados.\n\nSem suposições: indicar explicitamente quando algo não estiver nos documentos.\n\nTerminologia consistente: sempre usar “retroatividade” e “LMG” (Limite Máximo de Garantia).\n\nIdioma: todas as respostas devem ser em português, mantendo apenas siglas usuais do mercado (D&O, E&O).\n\nSem meta-comentários: não escrever mensagens como “baseado nos seus documentos”, “trecho recuperado”, “fonte”, “observação”, “RAG”, “vetor” ou equivalentes.\n\nRegra de ouro\nSe qualquer parte da resposta não puder ser amparada exclusivamente nos trechos recuperados, remover a afirmação ou acionar “Quando não houver informação suficiente”.",
        "topK": 20
      },
      "id": "1a29e364-e1d4-4270-bd3b-8c77d22b0a3c",
      "name": "Vector Store Tool3",
      "type": "@n8n/n8n-nodes-langchain.toolVectorStore",
      "typeVersion": 1,
      "position": [
        336,
        736
      ]
    },
    {
      "parameters": {
        "tableName": {
          "__rl": true,
          "value": "documents",
          "mode": "list",
          "cachedResultName": "documents"
        },
        "options": {
          "queryName": "match_documents"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        608,
        720
      ],
      "id": "15ed311e-856d-4fb6-a130-43e2fabe2ae0",
      "name": "Supabase Vector Store5",
      "credentials": {
        "supabaseApi": {
          "id": "4PGtFDuqvBvB3tvc",
          "name": "supabase VPS"
        }
      }
    },
    {
      "parameters": {
        "options": {
          "batchSize": 128,
          "stripNewLines": true
        }
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        736,
        800
      ],
      "id": "95f7a5cc-fba8-41c2-9837-465b05ca44ae",
      "name": "Embeddings OpenAI7",
      "credentials": {
        "openAiApi": {
          "id": "6XodQNiVwLbmQE7G",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Start').item.json.body_message }}\n\n{{ $json.output }}",
        "options": {
          "systemMessage": "Você é um assistente de seguros. Para cada mensagem do usuário, chame retrieval_tool com a pergunta e construa a resposta somente a partir dos trechos retornados. Não mencione documentos, busca, base vetorial ou mecanismos internos.\nSe as evidências não forem suficientes para responder com segurança, responda apenas: “Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos?”\nFormatação: títulos no mesmo bloco com ** ** e quebra simples \\n. Terminologia: “retroatividade”, “LMG”; manter D&O e E&O. Responda sempre em português.\n\nSem convites de busca: não oferecer “posso buscar/confirmar nos seus documentos”. A consulta já foi feita internamente.\n\nSem meta-comentários: não usar frases como “baseado nos seus documentos”, “trecho recuperado”, “RAG”, “vetor”, “embedding” ou equivalentes.",
          "returnIntermediateSteps": true
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        64,
        672
      ],
      "id": "66559a2f-1c37-43b9-91fc-73d9dd01f499",
      "name": "AGENTE Pdf1"
    },
    {
      "parameters": {
        "operation": "pdf",
        "binaryPropertyName": "file",
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        -256,
        336
      ],
      "id": "fd23f418-e358-4f75-b939-e97509fda79c",
      "name": "Extrai Texto"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "d5bceaf7-31f1-4a8e-bfb7-30701681e837",
              "name": "output",
              "value": "={{ $('Start').item.json.sessionId }},{{ $('Start').item.json.userId }} : {{ $json.text }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -80,
        336
      ],
      "id": "5d213287-ea0a-48fd-aefc-e293cb8aee07",
      "name": "formata o titulo {{}} para o Agente"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        112,
        480
      ],
      "id": "d38b2a41-ee90-4f48-8f80-fca031a56918",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "3JiV6rPIxvxjMpnY",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "name": "user_documents",
        "description": "Contexto do acervo (fonte de verdade): este workspace reúne todo o material necessário para responder: apólices, condições gerais e cláusulas, leis e normas enviadas pelo usuário, resumos de vídeos, transcrições, planilhas e anotações. Trate esse acervo como a única fonte autorizada. É proibido responder sem consultar a base vetorial. Em caso de falha na recuperação, não inferir, não completar lacunas e não usar conhecimento externo.\n\nVocê é um assistente especialista em seguros, integrado a uma base vetorial contendo todos os documentos, apólices, PDFs, planilhas e transcrições fornecidos pelo usuário, além de textos adicionais.\n\nFluxo obrigatório antes de responder\nBusca com foco em seguros\n\nCriar um embedding da pergunta do usuário.\n\nConsultar a base vetorial priorizando termos técnicos de seguros (ex.: LMG, retroatividade, franquia, sinistro, D&O, E&O).\n\nReforçar sinônimos, variações e abreviações reconhecidas.\n\nReclassificar os resultados combinando pontuação de similaridade e presença de termos técnicos.\n\nGate RAG: se não houver evidências suficientes para responder com segurança, acionar a regra “Quando não houver informação suficiente”.\n\nRecuperação de evidências\n\nRecuperar a quantidade necessária de trechos, até um máximo de 5, priorizando qualidade e cobertura do tema.\n\nSe houver múltiplos tipos de fonte (ex.: PDF e transcrição), garantir diversidade com pelo menos um de cada quando disponível.\n\nPara cada trecho, registrar internamente: texto, título do documento e página ou timestamp.\n\nNão expor metadados técnicos nem o mecanismo de recuperação. Não usar rótulos como “trecho recuperado”, “fonte”, “observação”, “RAG”, “vetor”, “embedding”.\n\nLeitura e síntese\n\nLer os trechos recuperados e extrair: tipo de apólice, coberturas, exclusões, limites, vigência, retroatividade, franquias, obrigações pós-sinistro.\n\nSintetizar integrando as evidências e resolver conflitos pela hierarquia: apólice > endosso > transcrição.\n\nCheque de consistência: remover qualquer afirmação que não esteja explicitamente suportada pelos trechos utilizados.\n\nConstrução da resposta\nResumo: iniciar com um resumo direto e claro, baseado nos documentos, usando terminologia técnica de seguros\nDetalhamento técnico com evidências: desenvolver a explicação citando os trechos efetivamente utilizados, de forma discreta e natural, indicando apenas título do documento e página ou timestamp entre parênteses. Ex.: (Condições Gerais RC Profissional, p. 12) ou (Reunião Comitê, 00:13:45)\nEncerramento prático: concluir com uma sugestão de próximo passo ou pergunta de continuidade. Ex.: “Quer avaliar o impacto de aumentar o LMG?”\n\nNão usar marcadores como “Primeiro”, “Depois” ou “Por fim”.\n\nO texto deve ser contínuo, natural e didático.\n\nQuando não houver informação suficiente\nSe, após a recuperação e leitura, as evidências não forem suficientes para responder com segurança:\n“Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos?”\n\nNunca adivinhar ou inventar dados.\n\nNão responder sobre o tema sem evidências.\n\nComando especial /insert\nSe a mensagem do usuário começar com /insert, responder apenas:\n“Conteúdo recebido. Vou adicionar à base de conhecimento.”\n\nNão realizar busca nem aplicar a estrutura de resposta.\n\nA ingestão será feita por um sistema externo.\n\nRegras gerais de formatação e terminologia\n\nTítulos e seções no mesmo bloco: ao iniciar uma nova seção, colocar as primeiras palavras em negrito com ** ** e continuar o texto no mesmo bloco, usando apenas uma quebra de linha simples \\n. Ex.: Coberturas: descrição contínua no mesmo parágrafo. Opcionalmente, pode-se usar itálico em vez de negrito.\n\nCitações das evidências: somente título do documento e página ou timestamp entre parênteses, sem links ou rótulos explicativos.\n\nEscopo das fontes: nunca usar informação fora dos trechos recuperados.\n\nSem suposições: indicar explicitamente quando algo não estiver nos documentos.\n\nTerminologia consistente: sempre usar “retroatividade” e “LMG” (Limite Máximo de Garantia).\n\nIdioma: todas as respostas devem ser em português, mantendo apenas siglas usuais do mercado (D&O, E&O).\n\nSem meta-comentários: não escrever mensagens como “baseado nos seus documentos”, “trecho recuperado”, “fonte”, “observação”, “RAG”, “vetor” ou equivalentes.\n\nRegra de ouro\nSe qualquer parte da resposta não puder ser amparada exclusivamente nos trechos recuperados, remover a afirmação ou acionar “Quando não houver informação suficiente”.",
        "topK": 20
      },
      "id": "b463dac9-bd3e-4eb9-8d36-6db0e974a3f4",
      "name": "Vector Store Tool1",
      "type": "@n8n/n8n-nodes-langchain.toolVectorStore",
      "typeVersion": 1,
      "position": [
        368,
        368
      ]
    },
    {
      "parameters": {
        "tableName": {
          "__rl": true,
          "value": "documents",
          "mode": "list",
          "cachedResultName": "documents"
        },
        "options": {
          "queryName": "match_documents"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        672,
        368
      ],
      "id": "1f02d614-a67f-4f3f-bc59-8a37c910cac5",
      "name": "Supabase Vector Store2",
      "credentials": {
        "supabaseApi": {
          "id": "4PGtFDuqvBvB3tvc",
          "name": "supabase VPS"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Start').item.json.body_message }}\n\n{{ $json.output }}",
        "options": {
          "systemMessage": "Você é um assistente de seguros. Para cada mensagem do usuário, chame retrieval_tool com a pergunta e construa a resposta somente a partir dos trechos retornados. Não mencione documentos, busca, base vetorial ou mecanismos internos.\nSe as evidências não forem suficientes para responder com segurança, responda apenas: “Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos?”\nFormatação: títulos no mesmo bloco com ** ** e quebra simples \\n. Terminologia: “retroatividade”, “LMG”; manter D&O e E&O. Responda sempre em português.\n\nSem convites de busca: não oferecer “posso buscar/confirmar nos seus documentos”. A consulta já foi feita internamente.\n\nSem meta-comentários: não usar frases como “baseado nos seus documentos”, “trecho recuperado”, “RAG”, “vetor”, “embedding” ou equivalentes.",
          "returnIntermediateSteps": true
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        112,
        336
      ],
      "id": "acb7d37e-ae60-4394-a2d1-59e4d1b67f7d",
      "name": "AGENTE Pdf"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        784,
        496
      ],
      "id": "530b910d-26ab-462b-aeac-0d482b7fe9d1",
      "name": "Embeddings OpenAI2",
      "credentials": {
        "openAiApi": {
          "id": "6XodQNiVwLbmQE7G",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        416,
        496
      ],
      "id": "e88a5d17-59ac-4ff0-ac35-c8d62e2a22e7",
      "name": "Google Gemini Chat Model3",
      "credentials": {
        "googlePalmApi": {
          "id": "3JiV6rPIxvxjMpnY",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.output }}",
        "options": {
          "systemMessage": "Você é um assistente de seguros. Para cada mensagem do usuário, sempre chame retrieval_tool com a pergunta e construa a resposta somente a partir dos trechos retornados. Não mencione documentos, busca, base vetorial ou mecanismos internos.\nSe as evidências não forem suficientes para responder com segurança, responda apenas: “Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos?”\nFormatação: títulos no mesmo bloco com ** ** e quebra simples \\n. Terminologia: “retroatividade”, “LMG”; manter D&O e E&O. Responda sempre em português.\n\nSem convites de busca: não oferecer “posso buscar/confirmar nos seus documentos”. A consulta já foi feita internamente.\n\nSem meta-comentários: não usar frases como “baseado nos seus documentos”, “trecho recuperado”, “RAG”, “vetor”, “embedding” ou equivalentes.\n\nse a conversa iniciar com a palavra \"/insert\", você deve responder apenas \"Conteúdo adicionado a base de conhecimentos\" sem consultar o banco vetorial\n\nse a pergunta conter palavras como 'Refinaria, Barril, Reservatório, Plataforma, Derivados, Petroquímica, Petrolífera, Petroleira' sugira o usuário a consultar a seguradora , responda algo como \"Infelizmente, por se tratar de informações importantes e específicas, recomendo que você consulte diretamente a seguradora para obter os detalhes mais precisos e atualizados.\"\n\nObservação muito importante, se o usuário lhe fazer uma pergunta sobre outro ramo que não seja D&O, por exemplo RC Profissional (E&O) ou até mesmo conhecimentos gerais, ou sobre outros nichos que não tem nada haver com Seguros E&O, responda com a mensagem : \"Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos? Pergunte algo relacionado a seguros D&O\"",
          "returnIntermediateSteps": true
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        -224,
        1584
      ],
      "id": "2aa41857-baff-481a-bf4d-208d5879c093",
      "name": "AGENTE d&o reranker 1"
    },
    {
      "parameters": {
        "operation": "text",
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        1584,
        -176
      ],
      "id": "bd9b2b42-d55e-44bf-b8a2-c617647e4f27",
      "name": "Extract from File2"
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "={{ $('set file_id1').item.json.file_id }}",
          "mode": "id"
        },
        "options": {
          "googleFileConversion": {
            "conversion": {
              "docsToFormat": "text/plain"
            }
          }
        }
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        1424,
        -176
      ],
      "id": "698f6e99-faff-4ad2-a5cd-a90f89c7df45",
      "name": "Download file1",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "lUbgshJTutnwWJS6",
          "name": "google drive tech"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "924b0573-9a2a-4b7c-ad88-b2f71fbfb4c0",
              "name": "file_id",
              "value": "={{ $json.documentId }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        864,
        -176
      ],
      "id": "74769c74-d31e-474b-82fc-421f560a3736",
      "name": "set file_id1"
    },
    {
      "parameters": {
        "operation": "update",
        "documentURL": "={{ $('set id1').item.json.file_id }}",
        "actionsUi": {
          "actionFields": [
            {
              "action": "replaceAll",
              "text": "={{ $('Get a document1').item.json.content }}",
              "replaceText": "={{ $json.output }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.googleDocs",
      "typeVersion": 2,
      "position": [
        624,
        -176
      ],
      "id": "e930ef67-c30e-466d-a7cb-454547190fe8",
      "name": "Update a document2",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "4WNH8Rkm8qdPvZND",
          "name": "Google Docs account"
        }
      }
    },
    {
      "parameters": {
        "amount": 30
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        1264,
        -176
      ],
      "id": "2ea4a878-7ba4-4c74-ae7a-2d55ff227515",
      "name": "Wait1",
      "webhookId": "8c3bdc1c-fb3e-4edf-b7a1-b8eb8e340e42"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f25c3af0-bc83-4a73-b675-7c6168b7beea",
              "name": "file_id",
              "value": "={{ $json.id }}",
              "type": "string"
            },
            {
              "id": "387c5636-d3f4-4126-bf0d-665f9fb14e7e",
              "name": "name_arq",
              "value": "={{ $json.name }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -160,
        -176
      ],
      "id": "49eb714b-fb96-4b0d-a19a-318b8fde7431",
      "name": "set id1"
    },
    {
      "parameters": {
        "operation": "get",
        "documentURL": "={{ $json.file_id }}"
      },
      "type": "n8n-nodes-base.googleDocs",
      "typeVersion": 2,
      "position": [
        16,
        -176
      ],
      "id": "1c58e378-60b9-404b-ab68-b45f94e1d85b",
      "name": "Get a document1",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "4WNH8Rkm8qdPvZND",
          "name": "Google Docs account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        144,
        0
      ],
      "id": "b4031629-10e4-4351-9285-870eb382a22b",
      "name": "Google Gemini Chat Model6",
      "credentials": {
        "googlePalmApi": {
          "id": "3JiV6rPIxvxjMpnY",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "mode": "insert",
        "tableName": {
          "__rl": true,
          "value": "d_o",
          "mode": "list",
          "cachedResultName": "d_o"
        },
        "embeddingBatchSize": 500,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        1840,
        -176
      ],
      "id": "8a30e745-5b5d-478e-aa4a-5824be688295",
      "name": "Supabase Vector Store d&o",
      "credentials": {
        "supabaseApi": {
          "id": "4PGtFDuqvBvB3tvc",
          "name": "supabase VPS"
        }
      }
    },
    {
      "parameters": {
        "options": {
          "batchSize": 128,
          "stripNewLines": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        2000,
        -864
      ],
      "id": "bbaa2c7a-c3d3-4943-8b70-651dffeabd73",
      "name": "Embeddings OpenAI8",
      "credentials": {
        "openAiApi": {
          "id": "6XodQNiVwLbmQE7G",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "chunkSize": 1250,
        "chunkOverlap": 100,
        "options": {
          "splitCode": "markdown"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter",
      "typeVersion": 1,
      "position": [
        2160,
        -864
      ],
      "id": "7acb550d-719a-44e1-8fcd-ea0136239abb",
      "name": "Recursive Character Text Splitter2"
    },
    {
      "parameters": {
        "jsonMode": "expressionData",
        "jsonData": "={{ $json.data }}",
        "options": {
          "metadata": {
            "metadataValues": [
              {
                "name": "file_id",
                "value": "={{ $('Edit Fields').item.json.file_id_2 }}"
              }
            ]
          }
        }
      },
      "id": "1844c87e-ad9f-4400-a99d-14bc3e35a50d",
      "name": "Default Data Loader2",
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "position": [
        2256,
        -944
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "amount": 30
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        1136,
        -992
      ],
      "id": "1bc1289f-1165-4e34-ba47-fe06064a8c7a",
      "name": "Wait2",
      "webhookId": "8c3bdc1c-fb3e-4edf-b7a1-b8eb8e340e42"
    },
    {
      "parameters": {
        "options": {
          "batchSize": 128,
          "stripNewLines": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        2016,
        -528
      ],
      "id": "e52ff541-f2c6-44c6-a3a1-8f49458f7b97",
      "name": "Embeddings OpenAI9",
      "credentials": {
        "openAiApi": {
          "id": "6XodQNiVwLbmQE7G",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "chunkSize": 1200,
        "options": {
          "splitCode": "markdown"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter",
      "typeVersion": 1,
      "position": [
        2176,
        -528
      ],
      "id": "3a8ea3e1-a5e7-4d06-9cb7-850a3ecac92f",
      "name": "Recursive Character Text Splitter3"
    },
    {
      "parameters": {
        "jsonMode": "expressionData",
        "jsonData": "={{ $json.data }}",
        "options": {
          "metadata": {
            "metadataValues": [
              {
                "name": "file_id",
                "value": "={{ $('set file_id3').item.json.file_id }}"
              }
            ]
          }
        }
      },
      "id": "13ea4a9e-fc5b-4857-89dd-6dcfa74cbcd7",
      "name": "Default Data Loader3",
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "position": [
        2272,
        -608
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "amount": 30
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        1120,
        -576
      ],
      "id": "27e5202c-f0bf-4e17-9c36-13702c51a771",
      "name": "Wait3",
      "webhookId": "8c3bdc1c-fb3e-4edf-b7a1-b8eb8e340e42"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Pode separar o conteúdo? como em parágrafos de no máximo 1000 chunks/caracteres cada, se possível é claro, se fizer sentido. E adicionando um titulo/Markdown com uma #titulo por exemplo? encima de cada parágrafo separado e uma leve frase sobre o conteúdo do parágrafo ao lado do titulo? retorne apenas o texto formatado por favor, sem alterar o conteudo do mesmo e adicionando no final de cada parágrafo \"trecho 1\", \"trecho 2\" e também o nome do arquivo como: {{ $('set id1').item.json.name_arq }}  etc. Segue o texto: \n{{ $json.content }}\n\nabaixo de cada parágrafo mostre como por exemplo \"Titulo: {arquivo tal}, trecho {2}\"",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        208,
        -176
      ],
      "id": "a34f6dfe-d54e-40cf-b64c-f7a37165b76e",
      "name": "AI Agent | d&o archives"
    },
    {
      "parameters": {
        "mode": "insert",
        "tableName": {
          "__rl": true,
          "value": "rcg",
          "mode": "list",
          "cachedResultName": "rcg"
        },
        "embeddingBatchSize": 300,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        2000,
        -1056
      ],
      "id": "287d41b7-fdf7-4d82-a95b-fc640da3989f",
      "name": "Supabase Vector Store RC-Geral",
      "credentials": {
        "supabaseApi": {
          "id": "4PGtFDuqvBvB3tvc",
          "name": "supabase VPS"
        }
      }
    },
    {
      "parameters": {
        "mode": "insert",
        "tableName": {
          "__rl": true,
          "value": "rcp",
          "mode": "list",
          "cachedResultName": "rcp"
        },
        "embeddingBatchSize": 300,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        2016,
        -720
      ],
      "id": "97e705b0-ad44-4dbd-a09c-efb41b38c5d1",
      "name": "Supabase Vector Store RC-Profissional",
      "credentials": {
        "supabaseApi": {
          "id": "4PGtFDuqvBvB3tvc",
          "name": "supabase VPS"
        }
      }
    },
    {
      "parameters": {
        "operation": "delete",
        "tableId": "rcp",
        "filterType": "string",
        "filterString": "=metadata->>file_id=like.*{{ $json.file_id }}*"
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        976,
        -576
      ],
      "id": "2efcad80-9410-41e1-a76a-4d488d22446d",
      "name": "Delete a row RC-Profissional",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "maxTries": 2,
      "waitBetweenTries": 3000,
      "credentials": {
        "supabaseApi": {
          "id": "4PGtFDuqvBvB3tvc",
          "name": "supabase VPS"
        }
      }
    },
    {
      "parameters": {
        "content": "## Triggers",
        "height": 1328,
        "width": 384,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -784,
        -1120
      ],
      "typeVersion": 1,
      "id": "2975b550-87ad-452e-93d8-a2ea7a50df75",
      "name": "Sticky Note10"
    },
    {
      "parameters": {
        "operation": "delete",
        "tableId": "rcg",
        "filterType": "string",
        "filterString": "=metadata->>file_id=like.*{{ $json.file_id_2 }}*"
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        976,
        -992
      ],
      "id": "4d2a0363-195c-42af-9840-62da57e699e1",
      "name": "Delete a row | RC-Geral",
      "alwaysOutputData": true,
      "retryOnFail": false,
      "maxTries": 2,
      "waitBetweenTries": 3000,
      "credentials": {
        "supabaseApi": {
          "id": "4PGtFDuqvBvB3tvc",
          "name": "supabase VPS"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Pode separar o conteúdo? como em parágrafos de no máximo 1000 chunks/caracteres cada, se possível é claro, se fizer sentido. E adicionando um titulo/Markdown com uma #titulo por exemplo? encima de cada parágrafo separado e uma leve frase sobre o conteúdo do parágrafo ao lado do titulo? retorne apenas o texto formatado por favor, sem alterar o conteudo do mesmo e adicionando no final de cada parágrafo \"trecho 1\", \"trecho 2\" e também o nome do arquivo como: {{ $('set id').item.json.name_arq }}  etc. Segue o texto: \n{{ $json.content }}\n\nabaixo de cada parágrafo mostre como por exemplo \"Titulo: {arquivo tal}, trecho {2}\"",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        192,
        -1408
      ],
      "id": "fbeb32a9-c9ba-4066-bc29-5401ce293398",
      "name": "AI Agent GLOBAL"
    },
    {
      "parameters": {
        "operation": "delete",
        "tableId": "d_o",
        "filterType": "string",
        "filterString": "=metadata->>file_id=like.*{{ $json.file_id }}*"
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1056,
        -176
      ],
      "id": "44988421-f785-4231-ad12-64d73927039c",
      "name": "Delete a row | d&o",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "maxTries": 2,
      "waitBetweenTries": 3000,
      "credentials": {
        "supabaseApi": {
          "id": "4PGtFDuqvBvB3tvc",
          "name": "supabase VPS"
        }
      }
    },
    {
      "parameters": {
        "operation": "text",
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        1504,
        -576
      ],
      "id": "0e301866-58e9-4e6d-90ad-719089583ca2",
      "name": "Extract from File4"
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "={{ $('set file_id3').item.json.file_id }}",
          "mode": "id"
        },
        "options": {
          "googleFileConversion": {
            "conversion": {
              "docsToFormat": "text/plain"
            }
          }
        }
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        1328,
        -576
      ],
      "id": "78598ffa-bb00-4302-be8f-d5c7aaa35be8",
      "name": "Download file3",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "lUbgshJTutnwWJS6",
          "name": "google drive tech"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f25c3af0-bc83-4a73-b675-7c6168b7beea",
              "name": "file_id",
              "value": "={{ $json.id }}",
              "type": "string"
            },
            {
              "id": "387c5636-d3f4-4126-bf0d-665f9fb14e7e",
              "name": "name_arq",
              "value": "={{ $json.name }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -176,
        -576
      ],
      "id": "d2e7f305-dcac-4c6a-bd4f-5434f704dce9",
      "name": "set id3"
    },
    {
      "parameters": {
        "operation": "get",
        "documentURL": "={{ $json.file_id }}"
      },
      "type": "n8n-nodes-base.googleDocs",
      "typeVersion": 2,
      "position": [
        0,
        -576
      ],
      "id": "d200df3f-8a95-4475-b2b6-be0266255d2a",
      "name": "Get a document3",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "4WNH8Rkm8qdPvZND",
          "name": "Google Docs account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Pode separar o conteúdo? como em parágrafos de no máximo 1000 chunks/caracteres cada, se possível é claro, se fizer sentido. E adicionando um titulo/Markdown com uma #titulo por exemplo? encima de cada parágrafo separado e uma leve frase sobre o conteúdo do parágrafo ao lado do titulo? retorne apenas o texto formatado por favor, sem alterar o conteudo do mesmo e adicionando no final de cada parágrafo \"trecho 1\", \"trecho 2\" e também o nome do arquivo como: {{ $('set id3').item.json.name_arq }}  etc. Segue o texto: \n{{ $json.content }}\n\nabaixo de cada parágrafo mostre como por exemplo \"Titulo: {arquivo tal}, trecho {2}\"",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        192,
        -576
      ],
      "id": "b79f4f5e-ef1a-4869-a441-f653ef614e25",
      "name": "AI Agent | d&o archives1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "924b0573-9a2a-4b7c-ad88-b2f71fbfb4c0",
              "name": "file_id",
              "value": "={{ $json.documentId }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        800,
        -576
      ],
      "id": "31db222e-d081-4fac-91b1-44565f122a30",
      "name": "set file_id3"
    },
    {
      "parameters": {
        "operation": "update",
        "documentURL": "={{ $('Get a document3').item.json.documentId }}",
        "actionsUi": {
          "actionFields": [
            {
              "action": "replaceAll",
              "text": "={{ $('Get a document3').item.json.content }}",
              "replaceText": "={{ $json.output }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.googleDocs",
      "typeVersion": 2,
      "position": [
        608,
        -576
      ],
      "id": "f36b05da-eea2-4659-a06d-5910fc649dd0",
      "name": "Update a document3",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "4WNH8Rkm8qdPvZND",
          "name": "Google Docs account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        144,
        -384
      ],
      "id": "2a0f535e-62bc-4bde-84f7-c5a0e0a658d3",
      "name": "Google Gemini Chat Model8",
      "credentials": {
        "googlePalmApi": {
          "id": "3JiV6rPIxvxjMpnY",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f25c3af0-bc83-4a73-b675-7c6168b7beea",
              "name": "file_id",
              "value": "={{ $json.id }}",
              "type": "string"
            },
            {
              "id": "387c5636-d3f4-4126-bf0d-665f9fb14e7e",
              "name": "name_arq",
              "value": "={{ $json.name }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -224,
        -1008
      ],
      "id": "c29fae3d-cbd9-4dd1-b221-646373d680c8",
      "name": "set id4"
    },
    {
      "parameters": {
        "operation": "get",
        "documentURL": "={{ $json.file_id }}"
      },
      "type": "n8n-nodes-base.googleDocs",
      "typeVersion": 2,
      "position": [
        -48,
        -1008
      ],
      "id": "f46ef7ba-43a8-4059-a6e8-1fb210c898f0",
      "name": "Get a document4",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "4WNH8Rkm8qdPvZND",
          "name": "Google Docs account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentURL": "={{ $('set id4').item.json.file_id }}",
        "actionsUi": {
          "actionFields": [
            {
              "action": "replaceAll",
              "text": "={{ $('Get a document4').item.json.content }}",
              "replaceText": "={{ $json.output }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.googleDocs",
      "typeVersion": 2,
      "position": [
        624,
        -992
      ],
      "id": "04db3be2-dd31-4a46-a375-214accff944d",
      "name": "Update a document4",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "4WNH8Rkm8qdPvZND",
          "name": "Google Docs account"
        }
      }
    },
    {
      "parameters": {
        "operation": "text",
        "options": {
          "encoding": "utf8"
        }
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        1504,
        -992
      ],
      "id": "4eb5e19c-f0a0-42e6-b6ef-f1cc567a3404",
      "name": "Extract from File5"
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "={{ $json.metadata.file_id }}",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        1536,
        -1168
      ],
      "id": "fc75f3b5-a9f5-4b2f-8ceb-fdaa3a5bc8db",
      "name": "Download file4",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "lUbgshJTutnwWJS6",
          "name": "google drive tech"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        144,
        -1232
      ],
      "id": "3653251b-8279-4fc2-a9f2-16a1064da093",
      "name": "Google Gemini Chat Model2",
      "credentials": {
        "googlePalmApi": {
          "id": "3JiV6rPIxvxjMpnY",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "ce77820d-3624-4c99-bf07-371da591c7c0",
              "name": "file_id_2",
              "value": "={{ $json.documentId }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        816,
        -992
      ],
      "id": "daaed86b-e428-4f8d-a7a2-c9d6121579ee",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.metadata.file_id }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    },
                    "id": "480ca0c6-ed56-4f47-8cd5-1f0ebcab45a5"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "1de3eb0f-b8f0-41e3-960b-5c0f586d7b88",
                    "leftValue": "={{ $json.metadata.file_id }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "notExists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        1328,
        -1168
      ],
      "id": "11a229c4-61e8-4ffd-b220-a7c7068ec820",
      "name": "Switch3"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "8c1249ba-2270-49da-867b-6986173ac1e5",
                    "leftValue": "={{ $json.output }}",
                    "rightValue": "Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos?",
                    "operator": {
                      "type": "string",
                      "operation": "notContains"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.output }}",
                    "rightValue": "=Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos?",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    },
                    "id": "28368e6f-2c26-4be0-ae11-8150b413a47c"
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        144,
        2160
      ],
      "id": "62dfed26-2831-4464-aa15-10a64f378088",
      "name": "fallback5"
    },
    {
      "parameters": {
        "content": "## RCG\n",
        "height": 560,
        "width": 1360,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -368,
        2144
      ],
      "typeVersion": 1,
      "id": "513c40f5-5645-4d3b-94bf-70dae115b4fa",
      "name": "Sticky Note18"
    },
    {
      "parameters": {
        "modelName": "rerank-multilingual-v3.0",
        "topN": 7
      },
      "type": "@n8n/n8n-nodes-langchain.rerankerCohere",
      "typeVersion": 1,
      "position": [
        -64,
        2432
      ],
      "id": "f09ea21c-cf56-463a-839a-73f9913aff6f",
      "name": "Reranker Cohere2",
      "credentials": {
        "cohereApi": {
          "id": "S13muyow0gTEETIc",
          "name": "CohereApi produção"
        }
      }
    },
    {
      "parameters": {
        "options": {
          "batchSize": 300,
          "stripNewLines": true
        }
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        -176,
        2544
      ],
      "id": "bd92ab43-6787-4a55-bb56-6fad8ed6a84f",
      "name": "Embeddings OpenAI10",
      "credentials": {
        "openAiApi": {
          "id": "6XodQNiVwLbmQE7G",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "You are a Retrieval-Augmented Generation (RAG) assistant specialized in insurance, integrated with a vector store containing all documents, policies, PDFs, spreadsheets, and transcripts provided by the user, as well as text documents.\n\nMandatory workflow before answering\nInsurance-focused similarity search\n\nCreate an embedding of the user’s question.\n\nQuery the vector store, prioritizing precise insurance terms (for example: “LMG”, “retroatividade” [retroactivity], “franquia” [deductible], “sinistro” [claim], “D&O”, “Professional Liability”, etc.).\n\nApply extra reinforcement for recognized synonyms or acronyms.\n\nEvidence retrieval\nRetrieve exactly 5 most relevant excerpts.\n\nIf the similarity search results in no relevant information or the retrieved facts are not sufficient to answer, respond with:\n“Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos?”\n\nIf multiple source types exist (e.g., PDF vs. transcript), ensure diversity — at least one excerpt of each type when available.\n\nFor each excerpt, keep: text, document title, and page number or timestamp.\n\nReading and synthesis\nRead all 5 excerpts, extracting: policy types, coverages, exclusions, limits, effective dates, retroactivity, deductibles, post-claim obligations, etc.\n\nSynthesize the information across excerpts; resolve conflicts by source hierarchy (policy text > endorsement > transcript).\n\nAnswer construction\nThe answer must begin with a direct and clear summary, strictly based on the documents, using insurance terminology.\n\nThen, develop the explanation with technical details and evidence. Do not cite the retrieved excerpts inline with the text. Instead, collect all citations and list them at the end of the answer under a separate heading, such as \"Fontes\" or \"Evidências\".\n\nEnd with a practical suggestion or follow-up question to keep the interaction (e.g.: “Would you like to simulate the impact of increasing the LMG?”).\n\nDo not use labels such as “First paragraph”, “Next” or “Finally”. The response must be continuous and natural.\n\nInsufficient evidence\nIf the reading and synthesis step results in inadequate information or if there are no sufficient facts to answer the user's question, respond with:\n“Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos?”\n\nNever guess or invent information.\n\nSpecial command /learn:\nIf the user’s message starts with /insert:\n\nRespond only:\n“Content received. I will add it to the knowledge base.”\n\nDo not perform retrieval or apply response structure.\n\nAn external system will handle ingestion and incorporation.\n\nGeneral rules\nNever use information outside of the 5 retrieved excerpts.\n\nDo not make assumptions; explicitly state when something is absent in the documents.\n\nMaintain consistent terminology (for example: always “retroatividade” [retroactivity], not “lookback period”; always use “LMG” for Liability Limit).\n\nAll responses must be in Portuguese (pt-br), except for standard industry abbreviations (D&O, E&O, etc.).",
        "tableName": {
          "__rl": true,
          "value": "rcg",
          "mode": "list",
          "cachedResultName": "rcg"
        },
        "topK": 13,
        "useReranker": true,
        "options": {
          "queryName": "match_rcg"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        -176,
        2320
      ],
      "id": "28932679-7dbf-491d-8fdb-411557655278",
      "name": "retrieval_tool2",
      "credentials": {
        "supabaseApi": {
          "id": "4PGtFDuqvBvB3tvc",
          "name": "supabase VPS"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -288,
        2320
      ],
      "id": "81392a27-423d-40f3-bf7a-eefb23970e59",
      "name": "gemini-2.5-flash2",
      "credentials": {
        "googlePalmApi": {
          "id": "3JiV6rPIxvxjMpnY",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "name": "user_documents",
        "description": "Base de conhecimento sobre seguros de responsabilidade civil.  \nContém transcrições de aulas, materiais de treinamento, trechos de apólices, cláusulas, exclusões, exemplos de sinistros reais e orientações práticas para corretores.  \nAbrange temas como: retroatividade, LMG, franquia, POS, D&O, E&O, contratação, sinistros, coberturas e condições gerais.  \n",
        "topK": 5
      },
      "id": "0708e012-9e3a-47a2-bb18-5c39c9b29e51",
      "name": "Vector Store Tool4",
      "type": "@n8n/n8n-nodes-langchain.toolVectorStore",
      "typeVersion": 1,
      "position": [
        752,
        2320
      ]
    },
    {
      "parameters": {
        "tableName": {
          "__rl": true,
          "value": "rcg",
          "mode": "list",
          "cachedResultName": "rcg"
        },
        "options": {
          "queryName": "match_rcg"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        752,
        2432
      ],
      "id": "a84c4d3f-d947-48d9-919a-0b8f21070eaa",
      "name": "Supabase Vector Store6",
      "credentials": {
        "supabaseApi": {
          "id": "4PGtFDuqvBvB3tvc",
          "name": "supabase VPS"
        }
      }
    },
    {
      "parameters": {
        "options": {
          "batchSize": 300
        }
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        768,
        2544
      ],
      "id": "547aa926-18bb-4b89-b28d-f22c4218c287",
      "name": "Embeddings OpenAI11",
      "credentials": {
        "openAiApi": {
          "id": "6XodQNiVwLbmQE7G",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5",
          "mode": "list",
          "cachedResultName": "gpt-5"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        640,
        2336
      ],
      "id": "75151de1-ff08-4bf8-bde5-4fa76dc88501",
      "name": "OpenAI Chat Model5",
      "credentials": {
        "openAiApi": {
          "id": "6XodQNiVwLbmQE7G",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5",
          "mode": "list",
          "cachedResultName": "gpt-5"
        },
        "options": {
          "timeout": 600000
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        912,
        2544
      ],
      "id": "38406822-9ff9-40f1-8184-f69120b23087",
      "name": "gpt--1",
      "credentials": {
        "openAiApi": {
          "id": "6XodQNiVwLbmQE7G",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.output }}",
        "options": {
          "systemMessage": "Você é um assistente de seguros que opera exclusivamente com os trechos retornados pela retrieval_tool (banco “base de conhecimento sobre seguros de responsabilidade civil”).\nNunca use informações de fora dessa base. Ignore qualquer campo “response” que venha da ferramenta de busca; use apenas os trechos crus (pageContent + metadata).\n\nPrincípios (travas)\n\nFonte única: somente os trechos recebidos.\n\nRastreabilidade obrigatória: toda afirmação deve estar coberta pelos trechos e acompanhar citação compacta ao fim do parágrafo ou item.\n\n80/20 rígido: ≥ 80% do texto deve ser citação literal ou colagem mínima dos trechos (permitido […]). Até 20% pode ser síntese curta apenas para ligar ideias já citadas, com citação no final do parágrafo.\n\nSem conteúdo novo: proíbe exemplos, recomendações, números, condições, definições ou conclusões que não estejam literalmente nos trechos.\n\nMetadados ausentes (tolerância)\n\nSe metadata.file ou metadata.trecho não existirem:\n\nExtraia Nome_do_arquivo de uma linha iniciada por Titulo: dentro do pageContent (remova vírgulas e espaços finais).\n\nExtraia o número X a partir do padrão trecho <número> no pageContent.\n\nSe não encontrar, use (trecho ?, Arquivo_desconhecido).\n\nFormato de saída (fixo)\n\nResponda sempre com estas seções:\n\nResposta direta\nAté 2 frases que respondem objetivamente à pergunta, usando apenas ideias presentes nos trechos. Termine o parágrafo com citações compactas:\n(trecho X, Nome; trecho Y, Nome; …)\n\nCitações de suporte\n\n“Citação literal ou colagem mínima [...]” — (trecho X, Nome)\n\n“Citação literal ou colagem mínima [...]” — (trecho Y, Nome)\n\n(adicione quantas forem necessárias para sustentar integralmente a Resposta direta)\n\nFontes\n\n(trecho X, Nome)\n\n(trecho Y, Nome)\n\n(liste uma vez cada fonte usada; sem duplicatas)\n\nEstilo: use negrito apenas em títulos fixos acima; o corpo pode usar negrito pontual para realçar termos que já aparecem nos trechos (ex.: valores, expressões-chave).\n\nRegras de resposta\n\nSaudações curtas (“oi”, “olá”, “bom dia”, “boa tarde”, “boa noite”, “opa”, “salve”, “tudo bem?”): responda apenas “Olá! 👋” sem consultar a retrieval_tool.\n\nQualquer outra mensagem: siga o formato acima; não crie seções extras.\n\nFalta de base literal: se os trechos forem ausentes, insuficientes, contraditórios ou não sustentarem a resposta literalmente, responda exatamente:\n“Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos?”\n\nProibições absolutas\n\n❌ Conhecimento externo, inferências, “boas práticas”, conselhos genéricos.\n\n❌ Mencionar pipeline (vetor, RAG, embedding, documentos recuperados).\n\n❌ Alterar termos/siglas do mercado (retroatividade, LMG, D&O, E&O etc.).\n\n❌ Citar arquivos/trechos não presentes nos dados recebidos (aplique a tolerância descrita).\n\nAuto-checagem (antes de enviar)\n\nA Resposta direta tem no máx. 2 frases e termina com citações compactas?\n\n≥ 80% do texto total são citações literais/colagens dos trechos?\n\nAs Citações de suporte são literais/colagens e cada linha tem citação?\n\nA seção Fontes lista cada fonte usada uma única vez?\n\nNão há nada que não esteja nos trechos?\nSe alguma resposta for “não”, envie a mensagem padrão de falta de informação.",
          "returnIntermediateSteps": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        688,
        2176
      ],
      "id": "dc1965b5-73ea-43be-9d32-26b6da926ef7",
      "name": "AGENTE basico fallback "
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.output }}",
        "options": {
          "systemMessage": "Você é um assistente de seguros. Para cada mensagem do usuário, sempre chame retrieval_tool com a pergunta e construa a resposta somente a partir dos trechos retornados. Não mencione documentos, busca, base vetorial ou mecanismos internos.\nSe as evidências não forem suficientes para responder com segurança, responda apenas: “Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos?”\nFormatação: títulos no mesmo bloco com ** ** e quebra simples \\n. Terminologia: “retroatividade”, “LMG”; manter D&O e E&O. Responda sempre em português.\n\nSem convites de busca: não oferecer “posso buscar/confirmar nos seus documentos”. A consulta já foi feita internamente.\n\nSem meta-comentários: não usar frases como “baseado nos seus documentos”, “trecho recuperado”, “RAG”, “vetor”, “embedding” ou equivalentes.\n\nse a conversa iniciar com a palavra \"/insert\", você deve responder apenas \"Conteúdo adicionado a base de conhecimentos\" sem consultar o banco vetorial\n\nse a pergunta conter palavras como 'Refinaria, Barril, Reservatório, Plataforma, Derivados, Petroquímica, Petrolífera, Petroleira' sugira o usuário a consultar a seguradora , responda algo como \"Infelizmente, por se tratar de informações importantes e específicas, recomendo que você consulte diretamente a seguradora para obter os detalhes mais precisos e atualizados.\"",
          "returnIntermediateSteps": true
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        -240,
        2160
      ],
      "id": "1621510d-3a88-48ca-be3d-0a4d22d3675d",
      "name": "AGENTE rcg reranker"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "8c1249ba-2270-49da-867b-6986173ac1e5",
                    "leftValue": "={{ $json.output }}",
                    "rightValue": "Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos?",
                    "operator": {
                      "type": "string",
                      "operation": "notContains"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.output }}",
                    "rightValue": "=Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos?",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    },
                    "id": "28368e6f-2c26-4be0-ae11-8150b413a47c"
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        1040,
        2160
      ],
      "id": "dea66fdf-63fe-477a-b1a4-b4e0aa5b337f",
      "name": "fallback6"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Pode separar o conteúdo? como em parágrafos de no máximo 1250 chunks/caracteres cada, se possível é claro, se fizer sentido. E adicionando um titulo/Markdown com uma #titulo por exemplo? encima de cada parágrafo separado e uma leve frase sobre o conteúdo do parágrafo ao lado do titulo? retorne apenas o texto formatado por favor, sem alterar o conteudo do mesmo e adicionando no final de cada parágrafo \"trecho 1\", \"trecho 2\" e também o nome do arquivo como: {{ $('set id4').item.json.name_arq }}  etc. Segue o texto: \n{{ $json.content }}\n\nabaixo de cada parágrafo mostre como por exemplo \"Titulo: {arquivo tal}, trecho {2}\"",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        144,
        -1008
      ],
      "id": "44a092f0-287d-4003-a294-04b69f3da355",
      "name": "AI Agent | RCG archives2"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        16,
        -800
      ],
      "id": "50e14aaf-0fdd-4ab3-9ed7-358cde0029e7",
      "name": "Google Gemini Chat Model7",
      "credentials": {
        "googlePalmApi": {
          "id": "3JiV6rPIxvxjMpnY",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "={{ $('Edit Fields').item.json.file_id_2 }}",
          "mode": "id"
        },
        "options": {
          "googleFileConversion": {
            "conversion": {
              "docsToFormat": "text/plain"
            }
          }
        }
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        1312,
        -992
      ],
      "id": "c36d4cbe-3704-4393-aceb-30ddeffd27e2",
      "name": "Download file2",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "lUbgshJTutnwWJS6",
          "name": "google drive tech"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        -288,
        1936
      ],
      "id": "c5eee0a8-64af-433d-81b9-5c9004e6d4d6",
      "name": "Postgres Chat Memory4",
      "credentials": {
        "postgres": {
          "id": "Pacsdm5ViP161v2q",
          "name": "Postgres vps 2"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        -256,
        1376
      ],
      "id": "5fc868cd-5732-4235-b0c3-45325c5acd5f",
      "name": "Postgres Chat Memory2",
      "credentials": {
        "postgres": {
          "id": "Pacsdm5ViP161v2q",
          "name": "Postgres vps 2"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "59f64116-f236-45fc-8334-19a0f5331945",
              "name": "sessionId",
              "value": "={{$json[\"body\"][\"sessionId\"]}}  ",
              "type": "string"
            },
            {
              "id": "01c983d8-efd5-4f4d-a447-78f26a0bdea8",
              "name": "userId",
              "value": "={{ $json.body.userId }}",
              "type": "string"
            },
            {
              "id": "dec266a3-da10-4c9d-9673-1f3fcb422476",
              "name": "output",
              "value": "={{ $json.body.message }}",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        528,
        1584
      ],
      "id": "6747521a-b04e-4e44-8490-dd7c63d3ebb1",
      "name": "get sessionId && userId1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "59f64116-f236-45fc-8334-19a0f5331945",
              "name": "sessionId",
              "value": "={{$json[\"body\"][\"sessionId\"]}}  ",
              "type": "string"
            },
            {
              "id": "01c983d8-efd5-4f4d-a447-78f26a0bdea8",
              "name": "userId",
              "value": "={{ $json.body.userId }}",
              "type": "string"
            },
            {
              "id": "dec266a3-da10-4c9d-9673-1f3fcb422476",
              "name": "output",
              "value": "={{ $json.body.message }}",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        480,
        2176
      ],
      "id": "b1cd95ad-01fe-453b-87ec-9e5a8c675c67",
      "name": "get sessionId && userId2"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        -288,
        3072
      ],
      "id": "c4e76dfa-826d-47b3-8515-654f643a4b43",
      "name": "Postgres Chat Memory3",
      "credentials": {
        "postgres": {
          "id": "Pacsdm5ViP161v2q",
          "name": "Postgres vps 2"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "8c1249ba-2270-49da-867b-6986173ac1e5",
                    "leftValue": "={{ $json.output }}",
                    "rightValue": "Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos?",
                    "operator": {
                      "type": "string",
                      "operation": "notContains"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.output }}",
                    "rightValue": "=Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos?",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    },
                    "id": "28368e6f-2c26-4be0-ae11-8150b413a47c"
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        144,
        2752
      ],
      "id": "110fc98f-cd93-4c52-9569-a2cf9e69f2ad",
      "name": "fallback7"
    },
    {
      "parameters": {
        "content": "## RCP\n",
        "height": 560,
        "width": 1360,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -368,
        2736
      ],
      "typeVersion": 1,
      "id": "04a13b3f-e666-444a-bf32-838f3a726971",
      "name": "Sticky Note19"
    },
    {
      "parameters": {
        "modelName": "rerank-multilingual-v3.0",
        "topN": 7
      },
      "type": "@n8n/n8n-nodes-langchain.rerankerCohere",
      "typeVersion": 1,
      "position": [
        -64,
        3024
      ],
      "id": "d7f40479-9386-4000-aaca-7062eaf4e639",
      "name": "Reranker Cohere3",
      "credentials": {
        "cohereApi": {
          "id": "S13muyow0gTEETIc",
          "name": "CohereApi produção"
        }
      }
    },
    {
      "parameters": {
        "options": {
          "batchSize": 300,
          "stripNewLines": true
        }
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        -176,
        3136
      ],
      "id": "9a25a54d-819c-4a96-b944-07699f91385f",
      "name": "Embeddings OpenAI12",
      "credentials": {
        "openAiApi": {
          "id": "6XodQNiVwLbmQE7G",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -288,
        2912
      ],
      "id": "41a010c8-8088-497f-a29d-171dbdbabc6c",
      "name": "gemini-2.5-flash3",
      "credentials": {
        "googlePalmApi": {
          "id": "3JiV6rPIxvxjMpnY",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "name": "user_documents",
        "description": "Base de conhecimento sobre seguros de responsabilidade civil.  \nContém transcrições de aulas, materiais de treinamento, trechos de apólices, cláusulas, exclusões, exemplos de sinistros reais e orientações práticas para corretores.  \nAbrange temas como: retroatividade, LMG, franquia, POS, D&O, E&O, contratação, sinistros, coberturas e condições gerais.  \n",
        "topK": 5
      },
      "id": "d39a5c2d-f5ae-45da-ae4d-70794a1ccc11",
      "name": "Vector Store Tool5",
      "type": "@n8n/n8n-nodes-langchain.toolVectorStore",
      "typeVersion": 1,
      "position": [
        752,
        2912
      ]
    },
    {
      "parameters": {
        "tableName": {
          "__rl": true,
          "value": "rcp",
          "mode": "list",
          "cachedResultName": "rcp"
        },
        "options": {
          "queryName": "match_rcp"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        752,
        3024
      ],
      "id": "a849a745-3968-4339-8592-2866a81a6327",
      "name": "Supabase Vector Store7",
      "credentials": {
        "supabaseApi": {
          "id": "4PGtFDuqvBvB3tvc",
          "name": "supabase VPS"
        }
      }
    },
    {
      "parameters": {
        "options": {
          "batchSize": 300
        }
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        768,
        3136
      ],
      "id": "a7abaa38-1707-4c8d-a392-fde0b14fcb6a",
      "name": "Embeddings OpenAI13",
      "credentials": {
        "openAiApi": {
          "id": "6XodQNiVwLbmQE7G",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5",
          "mode": "list",
          "cachedResultName": "gpt-5"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        640,
        2928
      ],
      "id": "56d9610f-81f0-418f-9be0-4423ff3d50a2",
      "name": "OpenAI Chat Model6",
      "credentials": {
        "openAiApi": {
          "id": "6XodQNiVwLbmQE7G",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5",
          "mode": "list",
          "cachedResultName": "gpt-5"
        },
        "options": {
          "timeout": 600000
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        912,
        3136
      ],
      "id": "8041e0ad-e38b-49f5-8166-c76fb671cfc6",
      "name": "gpt--2",
      "credentials": {
        "openAiApi": {
          "id": "6XodQNiVwLbmQE7G",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.output }}",
        "options": {
          "systemMessage": "Você é um assistente de seguros que opera exclusivamente com os trechos retornados pela retrieval_tool (banco “base de conhecimento sobre seguros de responsabilidade civil”).\nNunca use informações de fora dessa base. Ignore qualquer campo “response” que venha da ferramenta de busca; use apenas os trechos crus (pageContent + metadata).\n\nPrincípios (travas)\n\nFonte única: somente os trechos recebidos.\n\nRastreabilidade obrigatória: toda afirmação deve estar coberta pelos trechos e acompanhar citação compacta ao fim do parágrafo ou item.\n\n80/20 rígido: ≥ 80% do texto deve ser citação literal ou colagem mínima dos trechos (permitido […]). Até 20% pode ser síntese curta apenas para ligar ideias já citadas, com citação no final do parágrafo.\n\nSem conteúdo novo: proíbe exemplos, recomendações, números, condições, definições ou conclusões que não estejam literalmente nos trechos.\n\nMetadados ausentes (tolerância)\n\nSe metadata.file ou metadata.trecho não existirem:\n\nExtraia Nome_do_arquivo de uma linha iniciada por Titulo: dentro do pageContent (remova vírgulas e espaços finais).\n\nExtraia o número X a partir do padrão trecho <número> no pageContent.\n\nSe não encontrar, use (trecho ?, Arquivo_desconhecido).\n\nFormato de saída (fixo)\n\nResponda sempre com estas seções:\n\nResposta direta\nAté 2 frases que respondem objetivamente à pergunta, usando apenas ideias presentes nos trechos. Termine o parágrafo com citações compactas:\n(trecho X, Nome; trecho Y, Nome; …)\n\nCitações de suporte\n\n“Citação literal ou colagem mínima [...]” — (trecho X, Nome)\n\n“Citação literal ou colagem mínima [...]” — (trecho Y, Nome)\n\n(adicione quantas forem necessárias para sustentar integralmente a Resposta direta)\n\nFontes\n\n(trecho X, Nome)\n\n(trecho Y, Nome)\n\n(liste uma vez cada fonte usada; sem duplicatas)\n\nEstilo: use negrito apenas em títulos fixos acima; o corpo pode usar negrito pontual para realçar termos que já aparecem nos trechos (ex.: valores, expressões-chave).\n\nRegras de resposta\n\nSaudações curtas (“oi”, “olá”, “bom dia”, “boa tarde”, “boa noite”, “opa”, “salve”, “tudo bem?”): responda apenas “Olá! 👋” sem consultar a retrieval_tool.\n\nQualquer outra mensagem: siga o formato acima; não crie seções extras.\n\nFalta de base literal: se os trechos forem ausentes, insuficientes, contraditórios ou não sustentarem a resposta literalmente, responda exatamente:\n“Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos?”\n\nProibições absolutas\n\n❌ Conhecimento externo, inferências, “boas práticas”, conselhos genéricos.\n\n❌ Mencionar pipeline (vetor, RAG, embedding, documentos recuperados).\n\n❌ Alterar termos/siglas do mercado (retroatividade, LMG, D&O, E&O etc.).\n\n❌ Citar arquivos/trechos não presentes nos dados recebidos (aplique a tolerância descrita).\n\nAuto-checagem (antes de enviar)\n\nA Resposta direta tem no máx. 2 frases e termina com citações compactas?\n\n≥ 80% do texto total são citações literais/colagens dos trechos?\n\nAs Citações de suporte são literais/colagens e cada linha tem citação?\n\nA seção Fontes lista cada fonte usada uma única vez?\n\nNão há nada que não esteja nos trechos?\nSe alguma resposta for “não”, envie a mensagem padrão de falta de informação.\n\n\n\nObservação muito importante, se o usuário lhe fazer uma pergunta sobre outro ramo que não seja RC Profissional, por exemplo (D&O) ou até mesmo conhecimentos gerais, ou sobre outros nichos que não tem nada haver com Seguros de RC Profissional (responsabilidade civil profissional), responda com a mensagem : \"Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos? Pergunte algo relacionado a seguros RC Profissional\"",
          "returnIntermediateSteps": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        688,
        2768
      ],
      "id": "8340e52f-f6b4-494a-a8e5-d18c9f55152b",
      "name": "AGENTE basico fallback 2"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "8c1249ba-2270-49da-867b-6986173ac1e5",
                    "leftValue": "={{ $json.output }}",
                    "rightValue": "Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos?",
                    "operator": {
                      "type": "string",
                      "operation": "notContains"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.output }}",
                    "rightValue": "=Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos?",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    },
                    "id": "28368e6f-2c26-4be0-ae11-8150b413a47c"
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        1040,
        2752
      ],
      "id": "73741af8-b298-496c-affb-9c8de9ebf450",
      "name": "fallback8"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "59f64116-f236-45fc-8334-19a0f5331945",
              "name": "sessionId",
              "value": "={{$json[\"body\"][\"sessionId\"]}}  ",
              "type": "string"
            },
            {
              "id": "01c983d8-efd5-4f4d-a447-78f26a0bdea8",
              "name": "userId",
              "value": "={{ $json.body.userId }}",
              "type": "string"
            },
            {
              "id": "dec266a3-da10-4c9d-9673-1f3fcb422476",
              "name": "output",
              "value": "={{ $json.body.message }}",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        480,
        2768
      ],
      "id": "b3db7f72-f6f3-47c5-9883-1721534e16c9",
      "name": "get sessionId && userId3"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.output }}",
        "options": {
          "systemMessage": "Você é um assistente de seguros. Para cada mensagem do usuário, sempre chame retrieval_tool com a pergunta e construa a resposta somente a partir dos trechos retornados. Não mencione documentos, busca, base vetorial ou mecanismos internos.\nSe as evidências não forem suficientes para responder com segurança, responda apenas: “Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos?”\nFormatação: títulos no mesmo bloco com ** ** e quebra simples \\n. Terminologia: “retroatividade”, “LMG”; manter D&O e E&O. Responda sempre em português.\n\nSem convites de busca: não oferecer “posso buscar/confirmar nos seus documentos”. A consulta já foi feita internamente.\n\nSem meta-comentários: não usar frases como “baseado nos seus documentos”, “trecho recuperado”, “RAG”, “vetor”, “embedding” ou equivalentes.\n\nse a conversa iniciar com a palavra \"/insert\", você deve responder apenas \"Conteúdo adicionado a base de conhecimentos\" sem consultar o banco vetorial\n\nse a pergunta conter palavras como 'Refinaria, Barril, Reservatório, Plataforma, Derivados, Petroquímica, Petrolífera, Petroleira' sugira o usuário a consultar a seguradora , responda algo como \"Infelizmente, por se tratar de informações importantes e específicas, recomendo que você consulte diretamente a seguradora para obter os detalhes mais precisos e atualizados.\"\n\nObservação muito importante, se o usuário lhe fazer uma pergunta sobre outro ramo que não seja RC Profissional, por exemplo (D&O) ou até mesmo conhecimentos gerais, ou sobre outros nichos que não tem nada haver com Seguros de RC Profissional (responsabilidade civil profissional), responda com a mensagem : \"Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos? Pergunte algo relacionado a seguros RC Profissional\"",
          "returnIntermediateSteps": true
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        -240,
        2752
      ],
      "id": "f33c25a9-a8cb-4366-920d-1450790722cc",
      "name": "AGENTE rcp reranker1"
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "You are a Retrieval-Augmented Generation (RAG) assistant specialized in insurance, integrated with a vector store containing all documents, policies, PDFs, spreadsheets, and transcripts provided by the user, as well as text documents.\n\nMandatory workflow before answering\nInsurance-focused similarity search\n\nCreate an embedding of the user’s question.\n\nQuery the vector store, prioritizing precise insurance terms (for example: “LMG”, “retroatividade” [retroactivity], “franquia” [deductible], “sinistro” [claim], “D&O”, “Professional Liability”, etc.).\n\nApply extra reinforcement for recognized synonyms or acronyms.\n\nEvidence retrieval\nRetrieve exactly 5 most relevant excerpts.\n\nIf the similarity search results in no relevant information or the retrieved facts are not sufficient to answer, respond with:\n“Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos?”\n\nIf multiple source types exist (e.g., PDF vs. transcript), ensure diversity — at least one excerpt of each type when available.\n\nFor each excerpt, keep: text, document title, and page number or timestamp.\n\nReading and synthesis\nRead all 5 excerpts, extracting: policy types, coverages, exclusions, limits, effective dates, retroactivity, deductibles, post-claim obligations, etc.\n\nSynthesize the information across excerpts; resolve conflicts by source hierarchy (policy text > endorsement > transcript).\n\nAnswer construction\nThe answer must begin with a direct and clear summary, strictly based on the documents, using insurance terminology.\n\nThen, develop the explanation with technical details and evidence. Do not cite the retrieved excerpts inline with the text. Instead, collect all citations and list them at the end of the answer under a separate heading, such as \"Fontes\" or \"Evidências\".\n\nEnd with a practical suggestion or follow-up question to keep the interaction (e.g.: “Would you like to simulate the impact of increasing the LMG?”).\n\nDo not use labels such as “First paragraph”, “Next” or “Finally”. The response must be continuous and natural.\n\nInsufficient evidence\nIf the reading and synthesis step results in inadequate information or if there are no sufficient facts to answer the user's question, respond with:\n“Não encontrei informações relevantes nos arquivos sobre esse tema. Deseja refinar a pesquisa, tentar sinônimos técnicos ou fornecer novos documentos?”\n\nNever guess or invent information.\n\nSpecial command /learn:\nIf the user’s message starts with /insert:\n\nRespond only:\n“Content received. I will add it to the knowledge base.”\n\nDo not perform retrieval or apply response structure.\n\nAn external system will handle ingestion and incorporation.\n\nGeneral rules\nNever use information outside of the 5 retrieved excerpts.\n\nDo not make assumptions; explicitly state when something is absent in the documents.\n\nMaintain consistent terminology (for example: always “retroatividade” [retroactivity], not “lookback period”; always use “LMG” for Liability Limit).\n\nAll responses must be in Portuguese (pt-br), except for standard industry abbreviations (D&O, E&O, etc.).",
        "tableName": {
          "__rl": true,
          "value": "rcp",
          "mode": "list",
          "cachedResultName": "rcp"
        },
        "topK": 13,
        "useReranker": true,
        "options": {
          "queryName": "match_rcp"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        -176,
        2912
      ],
      "id": "a15b2e16-c508-4628-935e-6d860ddfc6ff",
      "name": "retrieval_tool | RCP",
      "credentials": {
        "supabaseApi": {
          "id": "4PGtFDuqvBvB3tvc",
          "name": "supabase VPS"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        640,
        1952
      ],
      "id": "c4c1d992-dac7-48c0-b55e-26bc23efafcb",
      "name": "Postgres Chat Memory5",
      "credentials": {
        "postgres": {
          "id": "Pacsdm5ViP161v2q",
          "name": "Postgres vps 2"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        624,
        2480
      ],
      "id": "4bcc1913-47af-4862-8820-8b4ff3bd7073",
      "name": "Postgres Chat Memory6",
      "credentials": {
        "postgres": {
          "id": "Pacsdm5ViP161v2q",
          "name": "Postgres vps 2"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        640,
        3072
      ],
      "id": "9e6833a8-903a-471c-9e39-bb73d23d2b83",
      "name": "Postgres Chat Memory7",
      "credentials": {
        "postgres": {
          "id": "Pacsdm5ViP161v2q",
          "name": "Postgres vps 2"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        608,
        1376
      ],
      "id": "9d1f8bf7-40ba-4884-afce-068200662889",
      "name": "Postgres Chat Memory8",
      "credentials": {
        "postgres": {
          "id": "Pacsdm5ViP161v2q",
          "name": "Postgres vps 2"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "get sessionId && userId",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Resposta": {
      "main": [
        [
          {
            "node": "Salva RP Human",
            "type": "main",
            "index": 0
          },
          {
            "node": "Salva RP IA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent1": {
      "main": [
        [
          {
            "node": "Atualizar documento com informações Novas e revisadas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Verificar a entrada do usuário": {
      "main": [
        [
          {
            "node": "Atualizar documento com dados recebidos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Atualizar documento com dados recebidos": {
      "main": [
        []
      ]
    },
    "Recuperar o documento": {
      "main": [
        [
          {
            "node": "AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Salva RP IA": {
      "main": [
        [
          {
            "node": "Verificar a entrada do usuário",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Salva RP Human": {
      "main": [
        [
          {
            "node": "Verificar a entrada do usuário",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Files Created?1": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get sessionId && userId": {
      "main": [
        [
          {
            "node": "type arquivo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "ok",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "fail",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "fail": {
      "main": [
        []
      ]
    },
    "ok": {
      "main": [
        [
          {
            "node": "Download a file",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download a file": {
      "main": [
        [
          {
            "node": "Extract from File1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create a document": {
      "main": [
        [
          {
            "node": "Update a document",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from File1": {
      "main": [
        [
          {
            "node": "Create a document",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "type arquivo": {
      "main": [
        [
          {
            "node": "Switch2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory1": {
      "ai_memory": [
        []
      ]
    },
    "Embeddings OpenAI1": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Recursive Character Text Splitter": {
      "ai_textSplitter": [
        [
          {
            "node": "Default Data Loader",
            "type": "ai_textSplitter",
            "index": 0
          }
        ]
      ]
    },
    "Default Data Loader": {
      "ai_document": [
        [
          {
            "node": "Supabase Vector Store",
            "type": "ai_document",
            "index": 0
          }
        ]
      ]
    },
    "Delete a row": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from File": {
      "main": [
        [
          {
            "node": "Supabase Vector Store",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download file": {
      "main": [
        [
          {
            "node": "Extract from File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "set file_id": {
      "main": [
        [
          {
            "node": "Delete a row",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "set id": {
      "main": [
        [
          {
            "node": "Get a document",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get a document": {
      "main": [
        [
          {
            "node": "AI Agent GLOBAL",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update a document1": {
      "main": [
        [
          {
            "node": "set file_id",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "fallback": {
      "main": [
        [
          {
            "node": "Resposta",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "avaliação resposta:": {
      "main": [
        [
          {
            "node": "set fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "set fields": {
      "main": [
        [
          {
            "node": "rating type",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "rating type": {
      "main": [
        [
          {
            "node": "Gravar avaliação positiva",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Gravar avaliação negativa",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Download file",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "advogados e escr - update": {
      "main": [
        [
          {
            "node": "set id",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent2": {
      "main": [
        []
      ]
    },
    "fallback2": {
      "main": [
        [
          {
            "node": "Resposta",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AGENTE global fallback 2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "AI Agent3",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent3": {
      "main": [
        [
          {
            "node": "fallback3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Responda com erro:",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent2",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "fallback3": {
      "main": [
        [
          {
            "node": "AI Agent4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "resposta fallback",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent4": {
      "main": [
        [
          {
            "node": "Resposta",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent4",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model3": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent3",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "advogados e escr - create": {
      "main": [
        [
          {
            "node": "set id",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "main | updated": {
      "main": [
        [
          {
            "node": "set id",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "main | created": {
      "main": [
        [
          {
            "node": "set id",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "banco ex sinistro | created": {
      "main": [
        [
          {
            "node": "set id",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "banco ex sinistro | update": {
      "main": [
        [
          {
            "node": "set id",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "contator + escritório | create": {
      "main": [
        [
          {
            "node": "set id",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "contator + escritório | update": {
      "main": [
        [
          {
            "node": "set id",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "D&O | creaded": {
      "main": [
        [
          {
            "node": "set id1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "D&O | updated": {
      "main": [
        [
          {
            "node": "set id1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "dentistas + clinicas | created": {
      "main": [
        [
          {
            "node": "set id",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "dentistas + clinicas | updated": {
      "main": [
        [
          {
            "node": "set id",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "engenheiros + emp engenharia | updated": {
      "main": [
        [
          {
            "node": "set id",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "engenheiros + emp engenharia | created": {
      "main": [
        [
          {
            "node": "set id",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "masterclasses | created": {
      "main": [
        [
          {
            "node": "set id",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "masterclasses | updated": {
      "main": [
        [
          {
            "node": "set id",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "médico + clinica med | created": {
      "main": [
        [
          {
            "node": "set id",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "médico + clinica med | updated": {
      "main": [
        [
          {
            "node": "set id",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "mentorias | created": {
      "main": [
        [
          {
            "node": "set id",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "mentorias | updated": {
      "main": [
        [
          {
            "node": "set id",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "rc geral | created1": {
      "main": [
        [
          {
            "node": "set id4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "rc geral | updated": {
      "main": [
        [
          {
            "node": "set id4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "rc profissional | created": {
      "main": [
        [
          {
            "node": "set id3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "rc profissional | updated": {
      "main": [
        [
          {
            "node": "set id3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "sinistro | created1": {
      "main": [
        [
          {
            "node": "set id",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "sinistro | updated": {
      "main": [
        [
          {
            "node": "set id",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI3": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store d&o",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Recursive Character Text Splitter1": {
      "ai_textSplitter": [
        [
          {
            "node": "Default Data Loader1",
            "type": "ai_textSplitter",
            "index": 0
          }
        ]
      ]
    },
    "Default Data Loader1": {
      "ai_document": [
        [
          {
            "node": "Supabase Vector Store d&o",
            "type": "ai_document",
            "index": 0
          }
        ]
      ]
    },
    "fallback4": {
      "main": [
        [
          {
            "node": "Resposta",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "get sessionId && userId1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "fallback1": {
      "main": [
        [
          {
            "node": "Resposta",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch1": {
      "main": [
        [
          {
            "node": "AGENTE global reranker 2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AGENTE d&o reranker 1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AGENTE rcg reranker",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AGENTE rcp reranker1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch2": {
      "main": [
        [
          {
            "node": "Extrai Texto",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Extrai Texto1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "resposta fallback": {
      "main": [
        [
          {
            "node": "Salva RP Human",
            "type": "main",
            "index": 0
          },
          {
            "node": "Salva RP IA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Responda com erro:": {
      "main": [
        [
          {
            "node": "Salva RP Human",
            "type": "main",
            "index": 0
          },
          {
            "node": "Salva RP IA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Call agente-basic-reranker": {
      "main": [
        []
      ]
    },
    "Call agente-basic-fallback": {
      "main": [
        []
      ]
    },
    "Call agente-pdf-global": {
      "main": [
        []
      ]
    },
    "Call agente-pdf-basic": {
      "main": [
        []
      ]
    },
    "Call agente-global-RERANKER": {
      "main": [
        []
      ]
    },
    "Call agente-falback-basic-global": {
      "main": [
        []
      ]
    },
    "Reranker Cohere": {
      "ai_reranker": [
        [
          {
            "node": "retrieval_tool1",
            "type": "ai_reranker",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI6": {
      "ai_embedding": [
        [
          {
            "node": "retrieval_tool1",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "retrieval_tool1": {
      "ai_tool": [
        [
          {
            "node": "AGENTE d&o reranker 1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "gemini-2.5-flash1": {
      "ai_languageModel": [
        [
          {
            "node": "AGENTE d&o reranker 1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "AGENTE rcg reranker",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Vector Store Tool2": {
      "ai_tool": [
        [
          {
            "node": "AGENTE basico fallback 1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Vector Store4": {
      "ai_vectorStore": [
        [
          {
            "node": "Vector Store Tool2",
            "type": "ai_vectorStore",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI5": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store4",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model4": {
      "ai_languageModel": [
        [
          {
            "node": "AGENTE basico fallback 1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "gpt--": {
      "ai_languageModel": [
        [
          {
            "node": "Vector Store Tool2",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AGENTE basico fallback 1": {
      "main": [
        [
          {
            "node": "fallback1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Reranker Cohere1": {
      "ai_reranker": [
        [
          {
            "node": "retrieval_tool",
            "type": "ai_reranker",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI4": {
      "ai_embedding": [
        [
          {
            "node": "retrieval_tool",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "gemini-2.5-flash": {
      "ai_languageModel": [
        [
          {
            "node": "AGENTE global reranker 2",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "retrieval_tool": {
      "ai_tool": [
        [
          {
            "node": "AGENTE global reranker 2",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Vector Store Tool": {
      "ai_tool": [
        [
          {
            "node": "AGENTE global fallback 2",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Vector Store1": {
      "ai_vectorStore": [
        [
          {
            "node": "Vector Store Tool",
            "type": "ai_vectorStore",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store1",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AGENTE global fallback 2",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "gpt--5": {
      "ai_languageModel": [
        [
          {
            "node": "Vector Store Tool",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AGENTE global reranker 2": {
      "main": [
        [
          {
            "node": "fallback2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AGENTE global fallback 2": {
      "main": [
        [
          {
            "node": "fallback",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extrai Texto1": {
      "main": [
        [
          {
            "node": "formata o titulo {{}} para o Agente1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "formata o titulo {{}} para o Agente1": {
      "main": [
        [
          {
            "node": "AGENTE Pdf1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model4": {
      "ai_languageModel": [
        [
          {
            "node": "Vector Store Tool3",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model5": {
      "ai_languageModel": [
        [
          {
            "node": "AGENTE Pdf1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Vector Store Tool3": {
      "ai_tool": [
        [
          {
            "node": "AGENTE Pdf1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Vector Store5": {
      "ai_vectorStore": [
        [
          {
            "node": "Vector Store Tool3",
            "type": "ai_vectorStore",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI7": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store5",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "AGENTE Pdf1": {
      "main": [
        [
          {
            "node": "Resposta",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extrai Texto": {
      "main": [
        [
          {
            "node": "formata o titulo {{}} para o Agente",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "formata o titulo {{}} para o Agente": {
      "main": [
        [
          {
            "node": "AGENTE Pdf",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AGENTE Pdf",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Vector Store Tool1": {
      "ai_tool": [
        [
          {
            "node": "AGENTE Pdf",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Vector Store2": {
      "ai_vectorStore": [
        [
          {
            "node": "Vector Store Tool1",
            "type": "ai_vectorStore",
            "index": 0
          }
        ]
      ]
    },
    "AGENTE Pdf": {
      "main": [
        [
          {
            "node": "Resposta",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI2": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store2",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model3": {
      "ai_languageModel": [
        [
          {
            "node": "Vector Store Tool1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AGENTE d&o reranker 1": {
      "main": [
        [
          {
            "node": "fallback4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download file1": {
      "main": [
        [
          {
            "node": "Extract from File2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "set file_id1": {
      "main": [
        [
          {
            "node": "Delete a row | d&o",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update a document2": {
      "main": [
        [
          {
            "node": "set file_id1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait1": {
      "main": [
        [
          {
            "node": "Download file1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from File2": {
      "main": [
        [
          {
            "node": "Supabase Vector Store d&o",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "set id1": {
      "main": [
        [
          {
            "node": "Get a document1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get a document1": {
      "main": [
        [
          {
            "node": "AI Agent | d&o archives",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model6": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent | d&o archives",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI8": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store RC-Geral",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Recursive Character Text Splitter2": {
      "ai_textSplitter": [
        [
          {
            "node": "Default Data Loader2",
            "type": "ai_textSplitter",
            "index": 0
          }
        ]
      ]
    },
    "Default Data Loader2": {
      "ai_document": [
        [
          {
            "node": "Supabase Vector Store RC-Geral",
            "type": "ai_document",
            "index": 0
          }
        ]
      ]
    },
    "Wait2": {
      "main": [
        [
          {
            "node": "Download file2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI9": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store RC-Profissional",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Recursive Character Text Splitter3": {
      "ai_textSplitter": [
        [
          {
            "node": "Default Data Loader3",
            "type": "ai_textSplitter",
            "index": 0
          }
        ]
      ]
    },
    "Default Data Loader3": {
      "ai_document": [
        [
          {
            "node": "Supabase Vector Store RC-Profissional",
            "type": "ai_document",
            "index": 0
          }
        ]
      ]
    },
    "Wait3": {
      "main": [
        [
          {
            "node": "Download file3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent | d&o archives": {
      "main": [
        [
          {
            "node": "Update a document2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delete a row RC-Profissional": {
      "main": [
        [
          {
            "node": "Wait3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delete a row | RC-Geral": {
      "main": [
        [
          {
            "node": "Wait2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent GLOBAL": {
      "main": [
        [
          {
            "node": "Update a document1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delete a row | d&o": {
      "main": [
        [
          {
            "node": "Wait1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download file3": {
      "main": [
        [
          {
            "node": "Extract from File4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from File4": {
      "main": [
        [
          {
            "node": "Supabase Vector Store RC-Profissional",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "set id3": {
      "main": [
        [
          {
            "node": "Get a document3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get a document3": {
      "main": [
        [
          {
            "node": "AI Agent | d&o archives1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update a document3": {
      "main": [
        [
          {
            "node": "set file_id3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent | d&o archives1": {
      "main": [
        [
          {
            "node": "Update a document3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "set file_id3": {
      "main": [
        [
          {
            "node": "Delete a row RC-Profissional",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model8": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent | d&o archives1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "set id4": {
      "main": [
        [
          {
            "node": "Get a document4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get a document4": {
      "main": [
        [
          {
            "node": "AI Agent | RCG archives2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update a document4": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download file4": {
      "main": [
        []
      ]
    },
    "Extract from File5": {
      "main": [
        [
          {
            "node": "Supabase Vector Store RC-Geral",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent GLOBAL",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Delete a row | RC-Geral",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch3": {
      "main": [
        [
          {
            "node": "Download file4",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "fallback5": {
      "main": [
        [
          {
            "node": "Resposta",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "get sessionId && userId2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Reranker Cohere2": {
      "ai_reranker": [
        [
          {
            "node": "retrieval_tool2",
            "type": "ai_reranker",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI10": {
      "ai_embedding": [
        [
          {
            "node": "retrieval_tool2",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "retrieval_tool2": {
      "ai_tool": [
        [
          {
            "node": "AGENTE rcg reranker",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "gemini-2.5-flash2": {
      "ai_languageModel": [
        [
          {
            "node": "AGENTE rcg reranker",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Vector Store Tool4": {
      "ai_tool": [
        [
          {
            "node": "AGENTE basico fallback ",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Vector Store6": {
      "ai_vectorStore": [
        [
          {
            "node": "Vector Store Tool4",
            "type": "ai_vectorStore",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI11": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store6",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model5": {
      "ai_languageModel": [
        [
          {
            "node": "AGENTE basico fallback ",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "gpt--1": {
      "ai_languageModel": [
        [
          {
            "node": "Vector Store Tool4",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AGENTE rcg reranker": {
      "main": [
        [
          {
            "node": "fallback5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AGENTE basico fallback ": {
      "main": [
        [
          {
            "node": "fallback6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "fallback6": {
      "main": [
        [
          {
            "node": "Resposta",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent | RCG archives2": {
      "main": [
        [
          {
            "node": "Update a document4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model7": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent | RCG archives2",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Download file2": {
      "main": [
        [
          {
            "node": "Extract from File5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory4": {
      "ai_memory": [
        [
          {
            "node": "AGENTE d&o reranker 1",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory2": {
      "ai_memory": [
        [
          {
            "node": "AGENTE global reranker 2",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "get sessionId && userId1": {
      "main": [
        [
          {
            "node": "AGENTE basico fallback 1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get sessionId && userId2": {
      "main": [
        [
          {
            "node": "AGENTE basico fallback ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory3": {
      "ai_memory": [
        [
          {
            "node": "AGENTE rcp reranker1",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "fallback7": {
      "main": [
        [
          {
            "node": "Resposta",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "get sessionId && userId3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Reranker Cohere3": {
      "ai_reranker": [
        [
          {
            "node": "retrieval_tool | RCP",
            "type": "ai_reranker",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI12": {
      "ai_embedding": [
        [
          {
            "node": "retrieval_tool | RCP",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "gemini-2.5-flash3": {
      "ai_languageModel": [
        [
          {
            "node": "AGENTE rcp reranker1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Vector Store Tool5": {
      "ai_tool": [
        [
          {
            "node": "AGENTE basico fallback 2",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Vector Store7": {
      "ai_vectorStore": [
        [
          {
            "node": "Vector Store Tool5",
            "type": "ai_vectorStore",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI13": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store7",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model6": {
      "ai_languageModel": [
        [
          {
            "node": "AGENTE basico fallback 2",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "gpt--2": {
      "ai_languageModel": [
        [
          {
            "node": "Vector Store Tool5",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AGENTE basico fallback 2": {
      "main": [
        [
          {
            "node": "fallback8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get sessionId && userId3": {
      "main": [
        [
          {
            "node": "AGENTE basico fallback 2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "fallback8": {
      "main": [
        [
          {
            "node": "Resposta",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AGENTE rcp reranker1": {
      "main": [
        [
          {
            "node": "fallback7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "retrieval_tool | RCP": {
      "ai_tool": [
        [
          {
            "node": "AGENTE rcp reranker1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory5": {
      "ai_memory": [
        [
          {
            "node": "AGENTE basico fallback 1",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory6": {
      "ai_memory": [
        [
          {
            "node": "AGENTE basico fallback ",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory7": {
      "ai_memory": [
        [
          {
            "node": "AGENTE basico fallback 2",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory8": {
      "ai_memory": [
        [
          {
            "node": "AGENTE global fallback 2",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "d4390b3b-9e1c-485f-8fea-0521bc8bed6f",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "33738330930e3881dd5571eca013f36ddf8aab20e4ea5c1f2ebaf4a2b4668ac6"
  },
  "id": "tGhILwJ6gamWxhJ4",
  "tags": [
    {
      "createdAt": "2025-07-25T15:14:18.730Z",
      "updatedAt": "2025-07-25T15:14:18.730Z",
      "id": "jEYagCXuInyUI8Y5",
      "name": "Ia | VendaSeguro Tech"
    },
    {
      "createdAt": "2025-07-29T17:41:27.443Z",
      "updatedAt": "2025-07-29T17:41:27.443Z",
      "id": "Eq0o6HPQzVdLU3IF",
      "name": "Desenvolvimento |"
    }
  ]
}